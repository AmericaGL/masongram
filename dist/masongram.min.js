"use strict";window.masongram=$.fn.masongram=function(t){return this.each(function(){new Masongram(this,t)})};var Masongram=function(t,e,n){function a(t,e){var n=this;s.forEach(function(t){n.require(t)}),u||(this.configure(e),this.setup(t))}var o,i,r,c,s=["jQuery","Masonry"],u=!1;return a.prototype={require:function(e){var a=t[e]!==n;return a||(u=!0,console.error("Dependency unavailable: "+e)),a},configure:function(t){o=e.extend(!0,{endpoint:"users/self",loop:!1,count:10,offset:10,size:"low_resolution",caption:"{caption}"},t)},setup:function(n){var a=this;i=e("<div>").attr({class:"masongram-container"}).appendTo(n),e("<div>").attr({class:"masongram-image-sizer masongram-image-size-"+o.size}).appendTo(i),i.masonry({itemSelector:".masongram-image-container",columnWidth:".masongram-image-sizer",percentPosition:!0}),r=new Resource(o),r.on("loaded",function(t){a.append(t)});var c;e(t).scroll(function(){c||(c=setTimeout(function(){i.imagesLoaded().progress(function(){e(t).scrollTop()+e(t).height()>e(document).height()*(1-o.offset/100)&&a.load()}),c=null},100))}),i.on("layoutComplete",function(){i.imagesLoaded().progress(function(){e("body").height()<e(t).height()&&a.load()})}),a.load()},load:function(){c||(c=!0,r.load())},append:function(n){n.forEach(function(a,r){var s=new Tile(a,{caption:o.caption,size:o.size}),u=s.getObject();setTimeout(function(){u.imagesLoaded().progress(function(){i.append(u).masonry("appended",u),r+1===n.length&&(c=!1,e(t).trigger("scroll"))})},200*r)})}},a}(window,jQuery),Resource=function(t,e,n){function a(t){o=t,i="https://api.instagram.com/v1/"+o.endpoint+"/media/recent/"}var o,i;return a.prototype={load:function(){if(i){var t=this,n=e.Deferred();return e.ajax({type:"POST",url:i,data:{access_token:o.access_token,count:o.count},dataType:"jsonp"}).success(function(a){e(t).trigger("loaded",[a.data]),n.resolve(a.data),o.loop||(i=!(!a.pagination||!a.pagination.next_url)&&a.pagination.next_url)}).error(function(){n.reject("Error fetching data")}),n.promise()}},on:function(t,n){e(this).on(t,function(t,e){n(e)})}},a}(window,jQuery),Tile=function(t,e,n){function a(t,e){i=t,r=e,this.parseLocation(),this.create()}var o,i,r,c="NO_DATA";return a.prototype={create:function(){o=e("<a>").attr({tabindex:0,class:"masongram-image-container masongram-image-size-"+r.size});var t=e("<img>").attr({src:i.images[r.size].url,width:i.images[r.size].width,height:i.images[r.size].height,class:"masongram-image"});t.appendTo(o);var n=e("<div>",{class:"masongram-image-caption-container"}),a=e("<div>",{class:"masongram-image-caption"});i.caption&&i.caption.text&&a.html(this.parseCaption()),a.appendTo(n),n.appendTo(o)},getObject:function(){return o},parseLocation:function(){if(i.caption&&i.caption.text&&/@[\d]+\.[\d]+,[\d]+\.[\d]+/.test(i.caption.text)){var t=i.caption.text.match(/@([\d]+\.[\d]+),([\d]+\.[\d]+)/);i.caption.text=i.caption.text.replace(/\s*@([\d]+\.[\d]+),([\d]+\.[\d]+)/,""),i.location={latitude:t[1],longitude:t[2]}}},parseCaption:function(){var t=r.caption;if(/{.*}/.test(t)){var e=t.match(/{([^}]+)}/g);e.forEach(function(e){switch(e){case"{location}":t=t.replace(e,i.location&&i.location.latitude!==n&&i.location.longitude!==n?i.location.latitude+","+i.location.longitude:c);break;case"{latitude}":t=t.replace(e,i.location&&i.location.latitude!==n?i.location.latitude:c);break;case"{longitude}":t=t.replace(e,i.location&&i.location.longitude!==n?i.location.longitude:c);break;case"{caption}":t=t.replace(e,i.caption&&i.caption.text!==n?i.caption.text:c);break;case"{likes}":t=t.replace(e,i.likes&&i.likes.count!==n?i.likes.count:c);break;case"{link}":t=t.replace(e,i.link?i.link:c)}})}return t}},a}(window,jQuery);
//# sourceMappingURL=masongram.min.js.map
