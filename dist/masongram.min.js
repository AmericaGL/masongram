!function(t){window.masongram=t.fn.masongram=function(e){var a=t.extend({access_token:"180267898.c46e184.b6475192f2734fa8a669f1c70800aa8f",endpoint:location.hash?"tags/"+location.hash.substr(1):"users/self",count:10,offset:100,columnWidth:324,loop:!1,map:"https://www.google.com/maps?q={latitude},{longitude}",title:"{caption} {map} {author} {likes}"},e);return this.each(function(){var e=this,n=document.createElement("div"),i=t(n);i.append('<div class="masongram-image-sizer">'),i.addClass("masongram-container"),i.appendTo(e),i.find(".masongram-image-container").fancybox({loop:!1,helpers:{overlay:{locked:!1}},afterLoad:function(){var t=i.find(".masongram-image-container").eq(this.index).data("object");this.title=a.title,this.title=this.title.replace(/\{caption}/gi,t.caption.text.replace(/#([^\s]+)/g,"<a onclick=\"masongram.filter('$1')\">#$1</a>").replace(/@([^\s]+)/g,'<a href="https://www.instagram.com/$1" target="_blank">@$1</a>')),this.title=this.title.replace(/\{map}/gi,t.location?'<a href="'+a.map.replace(/\{latitude}/g,t.location.latitude).replace(/\{longitude}/g,t.location.longitude)+'" target="_blank">map</a>':""),this.title=this.title.replace(/\{likes}/gi,t.user_has_liked?"&#9829;":"&#9825; "+t.likes.count),this.title=this.title.replace(/\{author}/gi,'<a href="https://www.instagram.com/'+t.user.username+'" target="_blank" title="'+t.user.full_name+'">@'+t.user.username+"</a>")},afterShow:function(){if(t("html, body").animate({scrollTop:i.find(".masongram-image-container").eq(this.index).offset().top}),this.index==this.group.length-1&&this.index!=i.find(".masongram-image-container").length-1){var e=i.find(".masongram-image-container").eq(this.index+1);this.group.push({href:e.attr("href"),type:"image"})}}}),i.masonry({itemSelector:".masongram-image-container",columnWidth:".masongram-image-sizer",percentPosition:!0});var o=function(){function n(e){if(!s){if(s=!0,!r.next_url){if(!a.loop)return void e();r.next_url="https://api.instagram.com/v1/"+a.endpoint+"/media/recent/"}t.ajax({type:"POST",url:r.next_url,data:{access_token:a.access_token,count:a.count},dataType:"jsonp",success:function(t){r=t.pagination,e(t.data,t.pagination&&t.pagination.next_url)},error:function(t){console.warn(t.statusText)},complete:function(){s=!1}})}}function o(e){var a=document.createElement("img");a.setAttribute("src",e.images.low_resolution.url),a.setAttribute("width",e.images.low_resolution.width),a.setAttribute("height",e.images.low_resolution.height),a.setAttribute("class","masongram-image");var n=document.createElement("div");n.setAttribute("class","masongram-image-caption"),n.innerHTML=e.caption.text;var o=document.createElement("div");o.setAttribute("class","masongram-image-caption-container"),o.appendChild(n);var r=document.createElement("a");r.setAttribute("href",e.images.standard_resolution.url),r.setAttribute("rel","masongram"),r.setAttribute("target","_blank"),r.setAttribute("class","masongram-image-container"),r.appendChild(a),r.appendChild(o);var s=t(r);s.hide(),s.data("object",e),i.append(s),s.imagesLoaded().progress(function(){s.show(),i.data("masonry").appended(s),t(window).trigger("scroll")})}var r={next_url:"https://api.instagram.com/v1/"+a.endpoint+"/media/recent/"},s=!1;return{append:function(){n(function(n,r){n&&n.forEach(function(s,c){o(s),a.loop||i.on("layoutComplete",function(){r||c!==n.length-1||i.imagesLoaded().progress(function(){t(e).trigger("masongram:api:end").off("masongram:api:end")})})})})}}}();o.append(),t(window).scroll(function(){i.imagesLoaded().progress(function(){t(window).scrollTop()+t(window).height()>t(document).height()-a.offset&&o.append()})}),i.on("layoutComplete",function(){i.imagesLoaded().progress(function(){t("body").height()<t(window).height()&&o.append()})})})},window.masongram.filter=function(t){window.location.hash=t},window.onhashchange=function(){t.fancybox.close(),window.location.reload()}}(jQuery);