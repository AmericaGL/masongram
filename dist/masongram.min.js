!function(a,t,e){a.masongram=e.fn.masongram=function(i){if(!i.access_token){if(!/access_token/.test(a.location.search)){var n='Missing required option "access_token". Read more at https://github.com/mladenplavsic/masongram';return this.each(function(){var a=this;e(t).ready(function(){e(a).trigger("masongram:error",n).off("masongram:error")})}),console.warn(n),this}i.access_token=a.location.search.replace(/.*access_token=([\w.]+).*/i,"$1")}/^[\w\d_-]+$/.test(a.location.hash)&&(i.endpoint="tags/"+a.location.hash.substr(1));var o=e.extend(!0,{endpoint:"users/self",count:10,offset:100,columnWidth:324,loop:!1,link:"fancybox",size:"low_resolution",map:"https://www.google.com/maps?q={map:latitude},{map:longitude}",title:{html:"{caption} {likes} {author} {map}",likes:"&#9825; {likes:count}",author:'<a href="https://www.instagram.com/{author:username}" target="_blank">{author:full_name}</a>'}},i);return o.title.map='<a href="'+o.map+'" target="_blank">map</a>',this.each(function(){var i=this,n=e("<div>").attr({class:"masongram-container"}).appendTo(i);e("<div>").attr({class:"masongram-image-sizer masongram-image-size-"+o.size}).appendTo(n),"map"===o.link||n.find(".masongram-image-container").fancybox({loop:!1,helpers:{overlay:{locked:!1}},afterLoad:function(){var a=n.find(".masongram-image-container").eq(this.index).data("object");this.title=o.title.html,a.caption&&(this.title=this.title.replace(/\{caption}/gi,a.caption.text.replace(/#([^\s]+)/g,"<a onclick=\"masongram.filter('$1')\">#$1</a>").replace(/@([^\s]+)/g,'<a href="https://www.instagram.com/$1" target="_blank">@$1</a>'))),this.title=this.title.replace(/\{likes}/gi,o.title.likes).replace(/\{likes:count}/gi,a.likes.count),this.title=this.title.replace(/\{author}/gi,o.title.author).replace(/\{author:username}/gi,a.user.username).replace(/\{author:full_name}/gi,a.user.full_name?a.user.full_name:a.user.username),a.location&&(this.title=this.title.replace(/\{map}/gi,o.title.map).replace(/\{map:latitude}/g,a.location.latitude).replace(/\{map:longitude}/g,a.location.longitude)),this.title=this.title.replace(/\{[^}]+}/gi,"").trim()},afterShow:function(){if(e("html, body").animate({scrollTop:n.find(".masongram-image-container").eq(this.index).offset().top}),this.index==this.group.length-1&&this.index!=n.find(".masongram-image-container").length-1){var a=n.find(".masongram-image-container").eq(this.index+1);this.group.push({href:a.attr("href"),type:"image"})}}}),n.masonry({itemSelector:".masongram-image-container",columnWidth:".masongram-image-sizer",percentPosition:!0});var r=function(){function t(a){if(!c){if(c=!0,!s.next_url){if(!o.loop)return void a();s.next_url="https://api.instagram.com/v1/"+o.endpoint+"/media/recent/"}e.ajax({type:"POST",url:s.next_url,data:{access_token:o.access_token,count:o.count},dataType:"jsonp",success:function(t){s=t.pagination,a(t.data,t.pagination&&t.pagination.next_url)},error:function(a){console.warn(a.statusText)},complete:function(){c=!1}})}}function r(t){if(t.caption&&t.caption.text&&/@[\d]+\.[\d]+,[\d]+\.[\d]+/.test(t.caption.text)){var i=t.caption.text.match(/@([\d]+\.[\d]+),([\d]+\.[\d]+)/);t.location={latitude:i[1],longitude:i[2]}}var r=e("<a>").attr({href:t.images.standard_resolution.url,rel:"masongram",target:"_blank",class:"masongram-image-container masongram-image-size-"+o.size});if("map"===o.link&&t.location){var s=o.map.replace(/\{map:latitude}/g,t.location.latitude).replace(/\{map:longitude}/g,t.location.longitude);r.attr("href",s)}if(e("<img>").attr({src:t.images[o.size].url,width:t.images[o.size].width,height:t.images[o.size].height,class:"masongram-image"}).appendTo(r),t.caption){var c=e("<div>").attr({class:"masongram-image-caption-container"});e("<div>").attr({class:"masongram-image-caption"}).html(t.caption.text).appendTo(c),r.append(c)}r.hide(),r.data("object",t),n.append(r),r.imagesLoaded().progress(function(){r.show(),n.data("masonry").appended(r),e(a).trigger("scroll")})}var s={next_url:"https://api.instagram.com/v1/"+o.endpoint+"/media/recent/"},c=!1;return{append:function(){t(function(a,t){a&&a.forEach(function(s,c){r(s),o.loop||n.on("layoutComplete",function(){t||c!==a.length-1||n.imagesLoaded().progress(function(){e(i).trigger("masongram:api:end").off("masongram:api:end")})})})})}}}();r.append(),e(a).scroll(function(){n.imagesLoaded().progress(function(){e(a).scrollTop()+e(a).height()>e(t).height()-o.offset&&r.append()})}),n.on("layoutComplete",function(){n.imagesLoaded().progress(function(){e("body").height()<e(a).height()&&r.append()})})})},a.masongram.filter=function(t){a.location.hash=t},a.onhashchange=function(){e.fancybox.close(),a.location.reload()}}(window,document,jQuery);