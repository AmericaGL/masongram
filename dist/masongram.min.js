"use strict";window.masongram=$.fn.masongram=function(t){return this.each(function(){new Masongram(this,t)})};var Masongram=function(){function t(t,n){var o=this;i.forEach(function(t){o.require(t)}),c||(this.configure(n),this.setup(t))}var n,o,e,a,i=["jQuery","Masonry"],c=!1;return t.prototype={require:function(t){var n=void 0!==window[t];return n||(c=!0,console.error("Dependency unavailable: "+t)),n},configure:function(t){n=$.extend(!0,{endpoint:"users/self",loop:!1,count:10,offset:10,size:"low_resolution",caption:"{caption}"},t)},setup:function(t){var a=this;o=$("<div>").attr({class:"masongram-container"}).appendTo(t),$("<div>").attr({class:"masongram-image-sizer masongram-image-size-"+n.size}).appendTo(o),o.masonry({itemSelector:".masongram-image-container",columnWidth:".masongram-image-sizer",percentPosition:!0}),e=new Resource(n),e.on("loaded",function(t){a.append(t)});var i;$(window).scroll(function(){i||(i=setTimeout(function(){o.imagesLoaded().progress(function(){$(window).scrollTop()+$(window).height()>$(document).height()*(1-n.offset/100)&&a.load()}),i=null},100))}),o.on("layoutComplete",function(){o.imagesLoaded().progress(function(){$("body").height()<$(window).height()&&a.load()})}),a.load()},load:function(){a||(a=!0,e.load())},append:function(t){t.forEach(function(e,i){var c=new Tile(e,{caption:n.caption,size:n.size}),r=c.getObject();setTimeout(function(){r.imagesLoaded().progress(function(){o.append(r).masonry("appended",r),i+1===t.length&&(a=!1,$(window).trigger("scroll"))})},200*i)})}},t}(),Resource=function(){function t(t){n=t,o="https://api.instagram.com/v1/"+n.endpoint+"/media/recent/"}var n,o;return t.prototype={load:function(){if(o){var t=this,e=$.Deferred();return $.ajax({type:"POST",url:o,data:{access_token:n.access_token,count:n.count},dataType:"jsonp"}).success(function(a){$(t).trigger("loaded",[a.data]),e.resolve(a.data),n.loop||(o=!(!a.pagination||!a.pagination.next_url)&&a.pagination.next_url)}).error(function(){e.reject("Error fetching data")}),e.promise()}},on:function(t,n){$(this).on(t,function(t,o){n(o)})}},t}(),Tile=function(){function t(t,n){o=t,e=n,this.parseLocation(),this.create()}var n,o,e,a="NO_DATA";return t.prototype={create:function(){n=$("<a>").attr({tabindex:0,class:"masongram-image-container masongram-image-size-"+e.size});var t=$("<img>").attr({src:o.images[e.size].url,width:o.images[e.size].width,height:o.images[e.size].height,class:"masongram-image"});t.appendTo(n);var a=$("<div>",{class:"masongram-image-caption-container"}),i=$("<div>",{class:"masongram-image-caption"});o.caption&&o.caption.text&&i.html(this.parseCaption()),i.appendTo(a),a.appendTo(n)},getObject:function(){return n},parseLocation:function(){if(o.caption&&o.caption.text&&/@[\d]+\.[\d]+,[\d]+\.[\d]+/.test(o.caption.text)){var t=o.caption.text.match(/@([\d]+\.[\d]+),([\d]+\.[\d]+)/);o.caption.text=o.caption.text.replace(/\s*@([\d]+\.[\d]+),([\d]+\.[\d]+)/,""),o.location={latitude:t[1],longitude:t[2]}}},parseCaption:function(){var t=e.caption;if(/{.*}/.test(t)){var n=t.match(/{([^}]+)}/g);n.forEach(function(n){switch(n){case"{location}":t=t.replace(n,o.location&&void 0!==o.location.latitude&&void 0!==o.location.longitude?o.location.latitude+","+o.location.longitude:a);break;case"{latitude}":t=t.replace(n,o.location&&void 0!==o.location.latitude?o.location.latitude:a);break;case"{longitude}":t=t.replace(n,o.location&&void 0!==o.location.longitude?o.location.longitude:a);break;case"{caption}":t=t.replace(n,o.caption&&void 0!==o.caption.text?o.caption.text:a);break;case"{likes}":t=t.replace(n,o.likes&&void 0!==o.likes.count?o.likes.count:a);break;case"{link}":t=t.replace(n,o.link?o.link:a)}})}return t}},t}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluaXQuanMiLCJtYXNvbmdyYW0uanMiLCJyZXNvdW9yY2UuanMiLCJ0aWxlLmpzIl0sIm5hbWVzIjpbIndpbmRvdyIsIm1hc29uZ3JhbSIsIiQiLCJmbiIsIm9wdGlvbnMiLCJ0aGlzIiwiZWFjaCIsIk1hc29uZ3JhbSIsIiRlbGVtZW50Iiwic2VsZiIsIl9kZXBlbmRlbmNpZXMiLCJmb3JFYWNoIiwibmFtZSIsInJlcXVpcmUiLCJfZXJyb3IiLCJjb25maWd1cmUiLCJzZXR1cCIsIl8kY29udGFpbmVyIiwiX3Jlc291cmNlIiwiX2luUHJvZ3Jlc3MiLCJwcm90b3R5cGUiLCJyZXN1bHQiLCJ1bmRlZmluZWQiLCJjb25zb2xlIiwiZXJyb3IiLCJfY29uZmlnIiwiZXh0ZW5kIiwiZW5kcG9pbnQiLCJsb29wIiwiY291bnQiLCJvZmZzZXQiLCJzaXplIiwiY2FwdGlvbiIsImF0dHIiLCJjbGFzcyIsImFwcGVuZFRvIiwibWFzb25yeSIsIml0ZW1TZWxlY3RvciIsImNvbHVtbldpZHRoIiwicGVyY2VudFBvc2l0aW9uIiwiUmVzb3VyY2UiLCJvbiIsIml0ZW1zIiwiYXBwZW5kIiwic2Nyb2xsVGltZW91dCIsInNjcm9sbCIsInNldFRpbWVvdXQiLCJpbWFnZXNMb2FkZWQiLCJwcm9ncmVzcyIsInNjcm9sbFRvcCIsImhlaWdodCIsImRvY3VtZW50IiwibG9hZCIsIml0ZW0iLCJpbmRleCIsInRpbGUiLCJUaWxlIiwiJG9iamVjdCIsImdldE9iamVjdCIsImxlbmd0aCIsInRyaWdnZXIiLCJjb25maWciLCJfdXJsIiwiZGVmZXJyZWQiLCJEZWZlcnJlZCIsImFqYXgiLCJ0eXBlIiwidXJsIiwiZGF0YSIsImFjY2Vzc190b2tlbiIsImRhdGFUeXBlIiwic3VjY2VzcyIsInJlc3BvbnNlIiwicmVzb2x2ZSIsInBhZ2luYXRpb24iLCJuZXh0X3VybCIsInJlamVjdCIsInByb21pc2UiLCJjYWxsYmFjayIsImV2ZW50IiwiX2RhdGEiLCJwYXJzZUxvY2F0aW9uIiwiY3JlYXRlIiwiXyRvYmplY3QiLCJfTk9fREFUQSIsInRhYmluZGV4IiwiJGltZyIsInNyYyIsImltYWdlcyIsIndpZHRoIiwiJGNhcHRpb25Db250YWluZXIiLCIkY2FwdGlvbiIsInRleHQiLCJodG1sIiwicGFyc2VDYXB0aW9uIiwidGVzdCIsImxvY2F0aW9uIiwibWF0Y2giLCJyZXBsYWNlIiwibGF0aXR1ZGUiLCJsb25naXR1ZGUiLCJtYXRjaGVzIiwibGlrZXMiLCJsaW5rIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUVBQSxRQUFBQyxVQUFBQyxFQUFBQyxHQUFBRixVQUFBLFNBQUFHLEdBQ0EsTUFBQUMsTUFBQUMsS0FBQSxXQUNBLEdBQUFDLFdBQUFGLEtBQUFELEtBRkEsSUFBQUcsV0FBQSxXQ0tBLFFBQUFBLEdBQUFDLEVBQUFKLEdEUEEsR0FBQUssR0FBQUosSUFFQUssR0FBQUMsUUFBQSxTQUFBQyxHQ1NBSCxFQUFBSSxRQUFBRCxLQUdBRSxJQUlBVCxLQUFBVSxVQUFBWCxHQUNBQyxLQUFBVyxNQUFBUixJRGZBLEdBRkFSLEdDQ0FpQixFQUNBQyxFQUNBQyxFRERBVCxHQUNBLFNBQ0EsV0NMQUksR0FBQSxDQTRIQSxPQXZHQVAsR0FBQWEsV0FFQVAsUUFBQSxTQUFBRCxHQUNBLEdBQUFTLEdBQUFDLFNBQUF0QixPQUFBWSxFQUtBLE9BSkFTLEtBQ0FQLEdBQUEsRUFDQVMsUUFBQUMsTUFBQSwyQkFBQVosSUFFQVMsR0FHQU4sVUFBQSxTQUFBWCxHQUNBcUIsRUFBQXZCLEVBQUF3QixRQUFBLEdBQ0FDLFNBQUEsYUFDQUMsTUFBQSxFQUNBQyxNQUFBLEdBQ0FDLE9BQUEsR0FDQUMsS0FBQSxpQkFDQUMsUUFBQSxhQUNBNUIsSUFHQVksTUFBQSxTQUFBUixHQUNBLEdBQUFDLEdBQUFKLElBQ0FZLEdBQUFmLEVBQUEsU0FDQStCLE1BQ0FDLE1BQUEsd0JBRUFDLFNBQUEzQixHQUVBTixFQUFBLFNBQ0ErQixNQUNBQyxNQUFBLDhDQUFBVCxFQUFBTSxPQUVBSSxTQUFBbEIsR0FFQUEsRUFBQW1C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LFNBQUFWLFNBQUEwRCxFQUFBaEQsUUFBQTRELEtBQUFaLEVBQUFoRCxRQUFBNEQsS0FBQVIsRUFDQSxNQUNBLEtBQUEsVUFDQVMsRUFBQUEsRUFBQUssUUFBQUQsRUFBQWpCLEVBQUFzQixPQUFBaEYsU0FBQTBELEVBQUFzQixNQUFBekUsTUFBQW1ELEVBQUFzQixNQUFBekUsTUFBQXVELEVBQ0EsTUFDQSxLQUFBLFNBQ0FTLEVBQUFBLEVBQUFLLFFBQUFELEVBQUFqQixFQUFBdUIsS0FBQXZCLEVBQUF1QixLQUFBbkIsTUFNQSxNQUFBUyxLQUtBckMiLCJmaWxlIjoibWFzb25ncmFtLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0Jztcblxud2luZG93Lm1hc29uZ3JhbSA9ICQuZm4ubWFzb25ncmFtID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgbmV3IE1hc29uZ3JhbSh0aGlzLCBvcHRpb25zKTtcbiAgfSk7XG59O1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG52YXIgTWFzb25ncmFtID0gKGZ1bmN0aW9uICgpIHtcblxuICB2YXIgX2RlcGVuZGVuY2llcyA9IFtcbiAgICAnalF1ZXJ5JyxcbiAgICAnTWFzb25yeScsXG4gIF07XG5cbiAgdmFyIF9lcnJvciA9IGZhbHNlO1xuICB2YXIgX2NvbmZpZztcbiAgdmFyIF8kY29udGFpbmVyO1xuICB2YXIgX3Jlc291cmNlO1xuICB2YXIgX2luUHJvZ3Jlc3M7XG5cbiAgZnVuY3Rpb24gTWFzb25ncmFtKCRlbGVtZW50LCBvcHRpb25zKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgX2RlcGVuZGVuY2llcy5mb3JFYWNoKGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICBzZWxmLnJlcXVpcmUobmFtZSk7XG4gICAgfSk7XG5cbiAgICBpZiAoX2Vycm9yKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5jb25maWd1cmUob3B0aW9ucyk7XG4gICAgdGhpcy5zZXR1cCgkZWxlbWVudCk7XG4gIH1cblxuICBNYXNvbmdyYW0ucHJvdG90eXBlID0ge1xuXG4gICAgcmVxdWlyZTogZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgIHZhciByZXN1bHQgPSB3aW5kb3dbIG5hbWUgXSAhPT0gdW5kZWZpbmVkO1xuICAgICAgaWYgKCFyZXN1bHQpIHtcbiAgICAgICAgX2Vycm9yID0gdHJ1ZTtcbiAgICAgICAgY29uc29sZS5lcnJvcignRGVwZW5kZW5jeSB1bmF2YWlsYWJsZTogJyArIG5hbWUpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9LFxuXG4gICAgY29uZmlndXJlOiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgX2NvbmZpZyA9ICQuZXh0ZW5kKHRydWUsIHtcbiAgICAgICAgZW5kcG9pbnQ6ICd1c2Vycy9zZWxmJyxcbiAgICAgICAgbG9vcDogZmFsc2UsXG4gICAgICAgIGNvdW50OiAxMCxcbiAgICAgICAgb2Zmc2V0OiAxMCxcbiAgICAgICAgc2l6ZTogJ2xvd19yZXNvbHV0aW9uJyxcbiAgICAgICAgY2FwdGlvbjogJ3tjYXB0aW9ufScsXG4gICAgICB9LCBvcHRpb25zKTtcbiAgICB9LFxuXG4gICAgc2V0dXA6IGZ1bmN0aW9uICgkZWxlbWVudCkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgXyRjb250YWluZXIgPSAkKCc8ZGl2PicpXG4gICAgICAgIC5hdHRyKHtcbiAgICAgICAgICBjbGFzczogJ21hc29uZ3JhbS1jb250YWluZXInLFxuICAgICAgICB9KVxuICAgICAgICAuYXBwZW5kVG8oJGVsZW1lbnQpO1xuXG4gICAgICAkKCc8ZGl2PicpXG4gICAgICAgIC5hdHRyKHtcbiAgICAgICAgICBjbGFzczogJ21hc29uZ3JhbS1pbWFnZS1zaXplciBtYXNvbmdyYW0taW1hZ2Utc2l6ZS0nICsgX2NvbmZpZy5zaXplLFxuICAgICAgICB9KVxuICAgICAgICAuYXBwZW5kVG8oXyRjb250YWluZXIpO1xuXG4gICAgICBfJGNvbnRhaW5lci5tYXNvbnJ5KHtcbiAgICAgICAgaXRlbVNlbGVjdG9yOiAnLm1hc29uZ3JhbS1pbWFnZS1jb250YWluZXInLFxuICAgICAgICBjb2x1bW5XaWR0aDogJy5tYXNvbmdyYW0taW1hZ2Utc2l6ZXInLFxuICAgICAgICBwZXJjZW50UG9zaXRpb246IHRydWUsXG4gICAgICB9KTtcblxuICAgICAgX3Jlc291cmNlID0gbmV3IFJlc291cmNlKF9jb25maWcpO1xuXG4gICAgICBfcmVzb3VyY2Uub24oJ2xvYWRlZCcsIGZ1bmN0aW9uIChpdGVtcykge1xuICAgICAgICBzZWxmLmFwcGVuZChpdGVtcyk7XG4gICAgICB9KTtcblxuICAgICAgLy8gbG9hZCBpbWFnZXMgd2hlbiBzY3JvbGxlZCBjbG9zZSB0byBib3R0b21cbiAgICAgIHZhciBzY3JvbGxUaW1lb3V0Oy8vIHRocm90dGxlXG4gICAgICAkKHdpbmRvdykuc2Nyb2xsKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCFzY3JvbGxUaW1lb3V0KSB7XG4gICAgICAgICAgc2Nyb2xsVGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgXyRjb250YWluZXIuaW1hZ2VzTG9hZGVkKCkucHJvZ3Jlc3MoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICBpZiAoJCh3aW5kb3cpLnNjcm9sbFRvcCgpICsgJCh3aW5kb3cpLmhlaWdodCgpID4gJChkb2N1bWVudCkuaGVpZ2h0KCkgKiAoMSAtIF9jb25maWcub2Zmc2V0IC8gMTAwKSkge1xuICAgICAgICAgICAgICAgIHNlbGYubG9hZCgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHNjcm9sbFRpbWVvdXQgPSBudWxsO1xuICAgICAgICAgIH0sIDEwMCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICAvLyBmaWxsIHdpbmRvdyBpZiB0aGVyZSBpcyB3aGl0ZSBzcGFjZSBsZWZ0XG4gICAgICBfJGNvbnRhaW5lci5vbignbGF5b3V0Q29tcGxldGUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIF8kY29udGFpbmVyLmltYWdlc0xvYWRlZCgpLnByb2dyZXNzKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBpZiAoJCgnYm9keScpLmhlaWdodCgpIDwgJCh3aW5kb3cpLmhlaWdodCgpKSB7XG4gICAgICAgICAgICBzZWxmLmxvYWQoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIHNlbGYubG9hZCgpO1xuICAgIH0sXG5cbiAgICBsb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoX2luUHJvZ3Jlc3MpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgX2luUHJvZ3Jlc3MgPSB0cnVlO1xuICAgICAgX3Jlc291cmNlLmxvYWQoKTtcbiAgICB9LFxuXG4gICAgYXBwZW5kOiBmdW5jdGlvbiAoaXRlbXMpIHtcbiAgICAgIGl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7XG4gICAgICAgIHZhciB0aWxlID0gbmV3IFRpbGUoaXRlbSwge1xuICAgICAgICAgIGNhcHRpb246IF9jb25maWcuY2FwdGlvbixcbiAgICAgICAgICBzaXplOiBfY29uZmlnLnNpemUsXG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgJG9iamVjdCA9IHRpbGUuZ2V0T2JqZWN0KCk7XG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICRvYmplY3QuaW1hZ2VzTG9hZGVkKCkucHJvZ3Jlc3MoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgXyRjb250YWluZXIuYXBwZW5kKCRvYmplY3QpLm1hc29ucnkoJ2FwcGVuZGVkJywgJG9iamVjdCk7XG4gICAgICAgICAgICBpZiAoaW5kZXggKyAxID09PSBpdGVtcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgX2luUHJvZ3Jlc3MgPSBmYWxzZTtcbiAgICAgICAgICAgICAgJCh3aW5kb3cpLnRyaWdnZXIoJ3Njcm9sbCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9LCBpbmRleCAqIDIwMCk7XG4gICAgICB9KTtcbiAgICB9LFxuICB9O1xuXG4gIHJldHVybiBNYXNvbmdyYW07XG5cbn0pKCk7XG4iLCIndXNlIHN0cmljdCc7XG5cbnZhciBSZXNvdXJjZSA9IChmdW5jdGlvbiAoKSB7XG5cbiAgdmFyIF9jb25maWc7XG4gIHZhciBfdXJsO1xuXG4gIGZ1bmN0aW9uIFJlc291cmNlKGNvbmZpZykge1xuICAgIF9jb25maWcgPSBjb25maWc7XG4gICAgX3VybCA9ICdodHRwczovL2FwaS5pbnN0YWdyYW0uY29tL3YxLycgKyBfY29uZmlnLmVuZHBvaW50ICsgJy9tZWRpYS9yZWNlbnQvJztcbiAgfVxuXG4gIFJlc291cmNlLnByb3RvdHlwZSA9IHtcblxuICAgIGxvYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICghX3VybCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgIHZhciBkZWZlcnJlZCA9ICQuRGVmZXJyZWQoKTtcblxuICAgICAgJC5hamF4KHtcbiAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICB1cmw6IF91cmwsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBhY2Nlc3NfdG9rZW46IF9jb25maWcuYWNjZXNzX3Rva2VuLFxuICAgICAgICAgIGNvdW50OiBfY29uZmlnLmNvdW50LFxuICAgICAgICB9LFxuICAgICAgICBkYXRhVHlwZTogJ2pzb25wJyxcbiAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICQoc2VsZikudHJpZ2dlcignbG9hZGVkJywgWyByZXNwb25zZS5kYXRhIF0pO1xuICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICBpZiAoIV9jb25maWcubG9vcCkge1xuICAgICAgICAgIC8vIFVzZWQgZm9yIHRlc3RpbmdcbiAgICAgICAgICBfdXJsID0gcmVzcG9uc2UucGFnaW5hdGlvbiAmJiByZXNwb25zZS5wYWdpbmF0aW9uLm5leHRfdXJsID8gcmVzcG9uc2UucGFnaW5hdGlvbi5uZXh0X3VybCA6IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9KS5lcnJvcihmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRlZmVycmVkLnJlamVjdCgnRXJyb3IgZmV0Y2hpbmcgZGF0YScpO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlKCk7XG4gICAgfSxcblxuICAgIG9uOiBmdW5jdGlvbiAobmFtZSwgY2FsbGJhY2spIHtcbiAgICAgICQodGhpcykub24obmFtZSwgZnVuY3Rpb24gKGV2ZW50LCBkYXRhKSB7XG4gICAgICAgIGNhbGxiYWNrKGRhdGEpO1xuICAgICAgfSk7XG4gICAgfSxcblxuICB9O1xuXG4gIHJldHVybiBSZXNvdXJjZTtcblxufSkoKTtcbiIsIid1c2Ugc3RyaWN0JztcblxudmFyIFRpbGUgPSAoZnVuY3Rpb24gKCkge1xuXG4gIHZhclxuICAgIF8kb2JqZWN0LFxuICAgIF9kYXRhLFxuICAgIF9jb25maWcsXG4gICAgX05PX0RBVEEgPSAnTk9fREFUQSc7XG5cbiAgZnVuY3Rpb24gVGlsZShkYXRhLCBjb25maWcpIHtcbiAgICBfZGF0YSA9IGRhdGE7XG4gICAgX2NvbmZpZyA9IGNvbmZpZztcbiAgICB0aGlzLnBhcnNlTG9jYXRpb24oKTtcbiAgICB0aGlzLmNyZWF0ZSgpO1xuICB9XG5cbiAgVGlsZS5wcm90b3R5cGUgPSB7XG5cbiAgICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgIF8kb2JqZWN0ID0gJCgnPGE+JykuYXR0cih7XG4gICAgICAgIHRhYmluZGV4OiAwLFxuICAgICAgICBjbGFzczogJ21hc29uZ3JhbS1pbWFnZS1jb250YWluZXIgbWFzb25ncmFtLWltYWdlLXNpemUtJyArIF9jb25maWcuc2l6ZSxcbiAgICAgIH0pO1xuXG4gICAgICB2YXIgJGltZyA9ICQoJzxpbWc+JykuYXR0cih7XG4gICAgICAgIHNyYzogX2RhdGEuaW1hZ2VzWyBfY29uZmlnLnNpemUgXS51cmwsXG4gICAgICAgIHdpZHRoOiBfZGF0YS5pbWFnZXNbIF9jb25maWcuc2l6ZSBdLndpZHRoLFxuICAgICAgICBoZWlnaHQ6IF9kYXRhLmltYWdlc1sgX2NvbmZpZy5zaXplIF0uaGVpZ2h0LFxuICAgICAgICBjbGFzczogJ21hc29uZ3JhbS1pbWFnZScsXG4gICAgICB9KTtcblxuICAgICAgJGltZy5hcHBlbmRUbyhfJG9iamVjdCk7XG5cbiAgICAgIHZhciAkY2FwdGlvbkNvbnRhaW5lciA9ICQoJzxkaXY+Jywge1xuICAgICAgICBjbGFzczogJ21hc29uZ3JhbS1pbWFnZS1jYXB0aW9uLWNvbnRhaW5lcicsXG4gICAgICB9KTtcblxuICAgICAgdmFyICRjYXB0aW9uID0gJCgnPGRpdj4nLCB7XG4gICAgICAgIGNsYXNzOiAnbWFzb25ncmFtLWltYWdlLWNhcHRpb24nLFxuICAgICAgfSk7XG5cbiAgICAgIGlmIChfZGF0YS5jYXB0aW9uICYmIF9kYXRhLmNhcHRpb24udGV4dCkge1xuICAgICAgICAkY2FwdGlvbi5odG1sKHRoaXMucGFyc2VDYXB0aW9uKCkpO1xuICAgICAgfVxuXG4gICAgICAkY2FwdGlvbi5hcHBlbmRUbygkY2FwdGlvbkNvbnRhaW5lcik7XG4gICAgICAkY2FwdGlvbkNvbnRhaW5lci5hcHBlbmRUbyhfJG9iamVjdCk7XG4gICAgfSxcblxuICAgIGdldE9iamVjdDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIF8kb2JqZWN0O1xuICAgIH0sXG5cbiAgICBwYXJzZUxvY2F0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoX2RhdGEuY2FwdGlvbiAmJiBfZGF0YS5jYXB0aW9uLnRleHQgJiYgL0BbXFxkXStcXC5bXFxkXSssW1xcZF0rXFwuW1xcZF0rLy50ZXN0KF9kYXRhLmNhcHRpb24udGV4dCkpIHtcbiAgICAgICAgdmFyIGxvY2F0aW9uID0gX2RhdGEuY2FwdGlvbi50ZXh0Lm1hdGNoKC9AKFtcXGRdK1xcLltcXGRdKyksKFtcXGRdK1xcLltcXGRdKykvKTtcbiAgICAgICAgX2RhdGEuY2FwdGlvbi50ZXh0ID0gX2RhdGEuY2FwdGlvbi50ZXh0LnJlcGxhY2UoL1xccypAKFtcXGRdK1xcLltcXGRdKyksKFtcXGRdK1xcLltcXGRdKykvLCAnJyk7XG4gICAgICAgIF9kYXRhLmxvY2F0aW9uID0ge1xuICAgICAgICAgIGxhdGl0dWRlOiBsb2NhdGlvblsgMSBdLFxuICAgICAgICAgIGxvbmdpdHVkZTogbG9jYXRpb25bIDIgXSxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgcGFyc2VDYXB0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgaHRtbCA9IF9jb25maWcuY2FwdGlvbjtcblxuICAgICAgaWYgKC97Lip9Ly50ZXN0KGh0bWwpKSB7XG4gICAgICAgIHZhciBtYXRjaGVzID0gaHRtbC5tYXRjaCgveyhbXn1dKyl9L2cpO1xuICAgICAgICBtYXRjaGVzLmZvckVhY2goZnVuY3Rpb24gKG1hdGNoKSB7XG4gICAgICAgICAgc3dpdGNoIChtYXRjaCkge1xuICAgICAgICAgICAgY2FzZSAne2xvY2F0aW9ufSc6XG4gICAgICAgICAgICAgIGh0bWwgPSBodG1sLnJlcGxhY2UobWF0Y2gsIF9kYXRhLmxvY2F0aW9uICYmIF9kYXRhLmxvY2F0aW9uLmxhdGl0dWRlICE9PSB1bmRlZmluZWQgJiYgX2RhdGEubG9jYXRpb24ubG9uZ2l0dWRlICE9PSB1bmRlZmluZWQgPyAoX2RhdGEubG9jYXRpb24ubGF0aXR1ZGUgKyAnLCcgKyBfZGF0YS5sb2NhdGlvbi5sb25naXR1ZGUpIDogX05PX0RBVEEpO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3tsYXRpdHVkZX0nOlxuICAgICAgICAgICAgICBodG1sID0gaHRtbC5yZXBsYWNlKG1hdGNoLCBfZGF0YS5sb2NhdGlvbiAmJiBfZGF0YS5sb2NhdGlvbi5sYXRpdHVkZSAhPT0gdW5kZWZpbmVkID8gX2RhdGEubG9jYXRpb24ubGF0aXR1ZGUgOiBfTk9fREFUQSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAne2xvbmdpdHVkZX0nOlxuICAgICAgICAgICAgICBodG1sID0gaHRtbC5yZXBsYWNlKG1hdGNoLCBfZGF0YS5sb2NhdGlvbiAmJiBfZGF0YS5sb2NhdGlvbi5sb25naXR1ZGUgIT09IHVuZGVmaW5lZCA/IF9kYXRhLmxvY2F0aW9uLmxvbmdpdHVkZSA6IF9OT19EQVRBKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd7Y2FwdGlvbn0nOlxuICAgICAgICAgICAgICBodG1sID0gaHRtbC5yZXBsYWNlKG1hdGNoLCBfZGF0YS5jYXB0aW9uICYmIF9kYXRhLmNhcHRpb24udGV4dCAhPT0gdW5kZWZpbmVkID8gX2RhdGEuY2FwdGlvbi50ZXh0IDogX05PX0RBVEEpO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3tsaWtlc30nOlxuICAgICAgICAgICAgICBodG1sID0gaHRtbC5yZXBsYWNlKG1hdGNoLCBfZGF0YS5saWtlcyAmJiBfZGF0YS5saWtlcy5jb3VudCAhPT0gdW5kZWZpbmVkID8gX2RhdGEubGlrZXMuY291bnQgOiBfTk9fREFUQSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAne2xpbmt9JzpcbiAgICAgICAgICAgICAgaHRtbCA9IGh0bWwucmVwbGFjZShtYXRjaCwgX2RhdGEubGluayA/IF9kYXRhLmxpbmsgOiBfTk9fREFUQSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBodG1sO1xuICAgIH0sXG5cbiAgfTtcblxuICByZXR1cm4gVGlsZTtcblxufSkoKTtcbiJdfQ==
