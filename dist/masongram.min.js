!function(t,e,a){t.masongram=a.fn.masongram=function(n){if(!n.access_token){if(!/access_token/.test(t.location.search))return console.warn('Missing required option "access_token". Read more at https://github.com/mladenplavsic/masongram'),this;n.access_token=t.location.search.replace(/.*access_token=([\w.]+).*/i,"$1")}t.location.hash&&(n.endpoint="tags/"+t.location.hash.substr(1));var i=a.extend(!0,{endpoint:"users/self",count:10,offset:100,columnWidth:324,loop:!1,map:"https://www.google.com/maps?q={latitude},{longitude}",title:"{caption} {map} {author} {likes}"},n);return this.each(function(){var n=this,o=e.createElement("div"),s=a(o);s.append('<div class="masongram-image-sizer">'),s.addClass("masongram-container"),s.appendTo(n),s.find(".masongram-image-container").fancybox({loop:!1,helpers:{overlay:{locked:!1}},afterLoad:function(){var t=s.find(".masongram-image-container").eq(this.index).data("object");this.title=i.title,this.title=this.title.replace(/\{caption}/gi,t.caption.text.replace(/#([^\s]+)/g,"<a onclick=\"masongram.filter('$1')\">#$1</a>").replace(/@([^\s]+)/g,'<a href="https://www.instagram.com/$1" target="_blank">@$1</a>')),this.title=this.title.replace(/\{map}/gi,t.location?'<a href="'+i.map.replace(/\{latitude}/g,t.location.latitude).replace(/\{longitude}/g,t.location.longitude)+'" target="_blank">map</a>':""),this.title=this.title.replace(/\{likes}/gi,t.user_has_liked?"&#9829;":"&#9825; "+t.likes.count),this.title=this.title.replace(/\{author}/gi,'<a href="https://www.instagram.com/'+t.user.username+'" target="_blank" title="'+t.user.full_name+'">@'+t.user.username+"</a>")},afterShow:function(){if(a("html, body").animate({scrollTop:s.find(".masongram-image-container").eq(this.index).offset().top}),this.index==this.group.length-1&&this.index!=s.find(".masongram-image-container").length-1){var t=s.find(".masongram-image-container").eq(this.index+1);this.group.push({href:t.attr("href"),type:"image"})}}}),s.masonry({itemSelector:".masongram-image-container",columnWidth:".masongram-image-sizer",percentPosition:!0});var r=function(){function o(t){if(!l){if(l=!0,!c.next_url){if(!i.loop)return void t();c.next_url="https://api.instagram.com/v1/"+i.endpoint+"/media/recent/"}a.ajax({type:"POST",url:c.next_url,data:{access_token:i.access_token,count:i.count},dataType:"jsonp",success:function(e){c=e.pagination,t(e.data,e.pagination&&e.pagination.next_url)},error:function(t){console.warn(t.statusText)},complete:function(){l=!1}})}}function r(n){var i=e.createElement("img");i.setAttribute("src",n.images.low_resolution.url),i.setAttribute("width",n.images.low_resolution.width),i.setAttribute("height",n.images.low_resolution.height),i.setAttribute("class","masongram-image");var o=e.createElement("div");o.setAttribute("class","masongram-image-caption"),o.innerHTML=n.caption.text;var r=e.createElement("div");r.setAttribute("class","masongram-image-caption-container"),r.appendChild(o);var c=e.createElement("a");c.setAttribute("href",n.images.standard_resolution.url),c.setAttribute("rel","masongram"),c.setAttribute("target","_blank"),c.setAttribute("class","masongram-image-container"),c.appendChild(i),c.appendChild(r);var l=a(c);l.hide(),l.data("object",n),s.append(l),l.imagesLoaded().progress(function(){l.show(),s.data("masonry").appended(l),a(t).trigger("scroll")})}var c={next_url:"https://api.instagram.com/v1/"+i.endpoint+"/media/recent/"},l=!1;return{append:function(){o(function(t,e){t&&t.forEach(function(o,c){r(o),i.loop||s.on("layoutComplete",function(){e||c!==t.length-1||s.imagesLoaded().progress(function(){a(n).trigger("masongram:api:end").off("masongram:api:end")})})})})}}}();r.append(),a(t).scroll(function(){s.imagesLoaded().progress(function(){a(t).scrollTop()+a(t).height()>a(e).height()-i.offset&&r.append()})}),s.on("layoutComplete",function(){s.imagesLoaded().progress(function(){a("body").height()<a(t).height()&&r.append()})})})},t.masongram.filter=function(e){t.location.hash=e},t.onhashchange=function(){a.fancybox.close(),t.location.reload()}}(window,document,jQuery);