{"version":3,"sources":["init.js","masongram.js","resouorce.js","tile.js"],"names":["window","masongram","$","fn","options","this","each","Masongram","undefined","$element","self","_dependencies","forEach","name","require","_error","configure","setup","_$container","_resource","_inProgress","prototype","result","console","error","_config","extend","endpoint","loop","count","offset","size","caption","attr","class","appendTo","masonry","itemSelector","columnWidth","percentPosition","Resource","on","items","append","scrollTimeout","scroll","setTimeout","imagesLoaded","progress","scrollTop","height","document","load","item","index","tile","Tile","$object","getObject","length","trigger","jQuery","config","_url","deferred","Deferred","ajax","type","url","data","access_token","dataType","success","response","resolve","pagination","next_url","reject","promise","callback","event","_data","parseLocation","create","_$object","_NO_DATA","tabindex","$img","src","images","width","$captionContainer","$caption","text","html","parseCaption","test","location","match","replace","latitude","longitude","matches","likes","link"],"mappings":"AAAA,YAEAA,QAAAC,UAAAC,EAAAC,GAAAF,UAAA,SAAAG,GACA,MAAAC,MAAAC,KAAA,WACA,GAAAC,WAAAF,KAAAD,KAFA,IAAAG,WAAA,SAAAP,EAAAE,EAAAM,GCKA,QAAAD,GAAAE,EAAAL,GDPA,GAAAM,GAAAL,IAEAM,GAAAC,QAAA,SAAAC,GCSAH,EAAAI,QAAAD,KAGAE,IAIAV,KAAAW,UAAAZ,GACAC,KAAAY,MAAAR,IDfA,GAFAT,GCCAkB,EACAC,EACAC,EDDAT,GACA,SACA,WCLAI,GAAA,CA4HA,OAvGAR,GAAAc,WAEAP,QAAA,SAAAD,GACA,GAAAS,GAAAtB,EAAAa,KAAAL,CAKA,OAJAc,KACAP,GAAA,EACAQ,QAAAC,MAAA,2BAAAX,IAEAS,GAGAN,UAAA,SAAAZ,GACAqB,EAAAvB,EAAAwB,QAAA,GACAC,SAAA,aACAC,MAAA,EACAC,MAAA,GACAC,OAAA,GACAC,KAAA,iBACAC,QAAA,aACA5B,IAGAa,MAAA,SAAAR,GACA,GAAAC,GAAAL,IACAa,GAAAhB,EAAA,SACA+B,MACAC,MAAA,wBAEAC,SAAA1B,GAEAP,EAAA,SACA+B,MACAC,MAAA,8CAAAT,EAAAM,OAEAI,SAAAjB,GAEAA,EAAAkB,SACAC,aAAA,6BACAC,YAAA,yBACAC,iBAAA,IAGApB,EAAA,GAAAqB,UAAAf,GAEAN,EAAAsB,GAAA,SAAA,SAAAC,GACAhC,EAAAiC,OAAAD,IAIA,IAAAE,EACA1C,GAAAF,GAAA6C,OAAA,WACAD,IACAA,EAAAE,WAAA,WACA5B,EAAA6B,eAAAC,SAAA,WACA9C,EAAAF,GAAAiD,YAAA/C,EAAAF,GAAAkD,SAAAhD,EAAAiD,UAAAD,UAAA,EAAAzB,EAAAK,OAAA,MACApB,EAAA0C,SAGAR,EAAA,MACA,QAKA1B,EAAAuB,GAAA,iBAAA,WACAvB,EAAA6B,eAAAC,SAAA,WACA9C,EAAA,QAAAgD,SAAAhD,EAAAF,GAAAkD,UACAxC,EAAA0C,WAKA1C,EAAA0C,QAGAA,KAAA,WACAhC,IAGAA,GAAA,EACAD,EAAAiC,SAGAT,OAAA,SAAAD,GACAA,EAAA9B,QAAA,SAAAyC,EAAAC,GACA,GAAAC,GAAA,GAAAC,MAAAH,GACArB,QAAAP,EAAAO,QACAD,KAAAN,EAAAM,OAEA0B,EAAAF,EAAAG,WACAZ,YAAA,WACAW,EAAAV,eAAAC,SAAA,WACA9B,EAAAyB,OAAAc,GAAArB,QAAA,WAAAqB,GClHAH,EAAA,IAAAZ,EAAAiB,SDoHAvC,GAAA,EClHAlB,EAAAF,GAAA4D,QAAA,cDsHA,IAAAN,OAKA/C,GAEAP,OAAA6D,QC7HArB,SAAA,SAAAxC,EAAAE,EAAAM,GAKA,QAAAgC,GAAAsB,GACArC,EAAAqC,EACAC,EAAA,gCAAAtC,EAAAE,SAAA,iBALA,GAAAF,GACAsC,CA+CA,OAxCAvB,GAAAnB,WAEA+B,KAAA,WACA,GAAAW,EAAA,CAIA,GAAArD,GAAAL,KACA2D,EAAA9D,EAAA+D,UAqBA,OAnBA/D,GAAAgE,MACAC,KAAA,OACAC,IAAAL,EACAM,MACAC,aAAA7C,EAAA6C,aACAzC,MAAAJ,EAAAI,OAEA0C,SAAA,UACAC,QAAA,SAAAC,GACAvE,EAAAQ,GAAAkD,QAAA,UAAAa,EAAAJ,OACAL,EAAAU,QAAAD,EAAAJ,MACA5C,EAAAG,OAEAmC,KAAAU,EAAAE,aAAAF,EAAAE,WAAAC,WAAAH,EAAAE,WAAAC,YAEApD,MAAA,WACAwC,EAAAa,OAAA,yBAGAb,EAAAc,YAGArC,GAAA,SAAA5B,EAAAkE,GACA7E,EAAAG,MAAAoC,GAAA5B,EAAA,SAAAmE,EAAAX,GACAU,EAAAV,OAMA7B,GAEAxC,OAAA6D,QCpDAL,KAAA,SAAAxD,EAAAE,EAAAM,GAQA,QAAAgD,GAAAa,EAAAP,GACAmB,EAAAZ,EACA5C,EAAAqC,EACAzD,KAAA6E,gBACA7E,KAAA8E,SAVA,GACAC,GACAH,EACAxD,EACA4D,EAAA,SA2FA,OAlFA7B,GAAAnC,WAEA8D,OAAA,WACAC,EAAAlF,EAAA,OAAA+B,MACAqD,SAAA,EACApD,MAAA,kDAAAT,EAAAM,MAGA,IAAAwD,GAAArF,EAAA,SAAA+B,MACAuD,IAAAP,EAAAQ,OAAAhE,EAAAM,MAAAqC,IACAsB,MAAAT,EAAAQ,OAAAhE,EAAAM,MAAA2D,MACAxC,OAAA+B,EAAAQ,OAAAhE,EAAAM,MAAAmB,OACAhB,MAAA,mBAGAqD,GAAApD,SAAAiD,EAEA,IAAAO,GAAAzF,EAAA,SACAgC,MAAA,sCAGA0D,EAAA1F,EAAA,SACAgC,MAAA,2BAGA+C,GAAAjD,SAAAiD,EAAAjD,QAAA6D,MACAD,EAAAE,KAAAzF,KAAA0F,gBAGAH,EAAAzD,SAAAwD,GACAA,EAAAxD,SAAAiD,IAGA1B,UAAA,WACA,MAAA0B,IAGAF,cAAA,WACA,GAAAD,EAAAjD,SAAAiD,EAAAjD,QAAA6D,MAAA,6BAAAG,KAAAf,EAAAjD,QAAA6D,MAAA,CACA,GAAAI,GAAAhB,EAAAjD,QAAA6D,KAAAK,MAAA,iCACAjB,GAAAjD,QAAA6D,KAAAZ,EAAAjD,QAAA6D,KAAAM,QAAA,oCAAA,IACAlB,EAAAgB,UACAG,SAAAH,EAAA,GACAI,UAAAJ,EAAA,MAKAF,aAAA,WACA,GAAAD,GAAArE,EAAAO,OAEA,IAAA,OAAAgE,KAAAF,GAAA,CACA,GAAAQ,GAAAR,EAAAI,MAAA,aACAI,GAAA1F,QAAA,SAAAsF,GACA,OAAAA,GACA,IAAA,aACAJ,EAAAA,EAAAK,QAAAD,EAAAjB,EAAAgB,UAAAhB,EAAAgB,SAAAG,WAAA5F,GAAAyE,EAAAgB,SAAAI,YAAA7F,EAAAyE,EAAAgB,SAAAG,SAAA,IAAAnB,EAAAgB,SAAAI,UAAAhB,EACA,MACA,KAAA,aACAS,EAAAA,EAAAK,QAAAD,EAAAjB,EAAAgB,UAAAhB,EAAAgB,SAAAG,WAAA5F,EAAAyE,EAAAgB,SAAAG,SAAAf,EACA,MACA,KAAA,cACAS,EAAAA,EAAAK,QAAAD,EAAAjB,EAAAgB,UAAAhB,EAAAgB,SAAAI,YAAA7F,EAAAyE,EAAAgB,SAAAI,UAAAhB,EACA,MACA,KAAA,YACAS,EAAAA,EAAAK,QAAAD,EAAAjB,EAAAjD,SAAAiD,EAAAjD,QAAA6D,OAAArF,EAAAyE,EAAAjD,QAAA6D,KAAAR,EACA,MACA,KAAA,UACAS,EAAAA,EAAAK,QAAAD,EAAAjB,EAAAsB,OAAAtB,EAAAsB,MAAA1E,QAAArB,EAAAyE,EAAAsB,MAAA1E,MAAAwD,EACA,MACA,KAAA,SACAS,EAAAA,EAAAK,QAAAD,EAAAjB,EAAAuB,KAAAvB,EAAAuB,KAAAnB,MAMA,MAAAS,KAKAtC,GAEAxD,OAAA6D","file":"masongram.min.js","sourcesContent":["'use strict';\n\nwindow.masongram = $.fn.masongram = function (options) {\n  return this.each(function () {\n    new Masongram(this, options);\n  });\n};\n","'use strict';\n\nvar Masongram = (function (window, $, undefined) {\n\n  var _dependencies = [\n    'jQuery',\n    'Masonry',\n  ];\n\n  var _error = false;\n  var _config;\n  var _$container;\n  var _resource;\n  var _inProgress;\n\n  function Masongram($element, options) {\n    var self = this;\n\n    _dependencies.forEach(function (name) {\n      self.require(name);\n    });\n\n    if (_error) {\n      return;\n    }\n\n    this.configure(options);\n    this.setup($element);\n  }\n\n  Masongram.prototype = {\n\n    require: function (name) {\n      var result = window[ name ] !== undefined;\n      if (!result) {\n        _error = true;\n        console.error('Dependency unavailable: ' + name);\n      }\n      return result;\n    },\n\n    configure: function (options) {\n      _config = $.extend(true, {\n        endpoint: 'users/self',\n        loop: false,\n        count: 10,\n        offset: 10,\n        size: 'low_resolution',\n        caption: '{caption}',\n      }, options);\n    },\n\n    setup: function ($element) {\n      var self = this;\n      _$container = $('<div>')\n        .attr({\n          class: 'masongram-container',\n        })\n        .appendTo($element);\n\n      $('<div>')\n        .attr({\n          class: 'masongram-image-sizer masongram-image-size-' + _config.size,\n        })\n        .appendTo(_$container);\n\n      _$container.masonry({\n        itemSelector: '.masongram-image-container',\n        columnWidth: '.masongram-image-sizer',\n        percentPosition: true,\n      });\n\n      _resource = new Resource(_config);\n\n      _resource.on('loaded', function (items) {\n        self.append(items);\n      });\n\n      // load images when scrolled close to bottom\n      var scrollTimeout;// throttle\n      $(window).scroll(function () {\n        if (!scrollTimeout) {\n          scrollTimeout = setTimeout(function () {\n            _$container.imagesLoaded().progress(function () {\n              if ($(window).scrollTop() + $(window).height() > $(document).height() * (1 - _config.offset / 100)) {\n                self.load();\n              }\n            });\n            scrollTimeout = null;\n          }, 100);\n        }\n      });\n\n      // fill window if there is white space left\n      _$container.on('layoutComplete', function () {\n        _$container.imagesLoaded().progress(function () {\n          if ($('body').height() < $(window).height()) {\n            self.load();\n          }\n        });\n      });\n\n      self.load();\n    },\n\n    load: function () {\n      if (_inProgress) {\n        return;\n      }\n      _inProgress = true;\n      _resource.load();\n    },\n\n    append: function (items) {\n      items.forEach(function (item, index) {\n        var tile = new Tile(item, {\n          caption: _config.caption,\n          size: _config.size,\n        });\n        var $object = tile.getObject();\n        setTimeout(function () {\n          $object.imagesLoaded().progress(function () {\n            _$container.append($object).masonry('appended', $object);\n            if (index + 1 === items.length) {\n              _inProgress = false;\n              $(window).trigger('scroll');\n            }\n          });\n        }, index * 200);\n      });\n    },\n  };\n\n  return Masongram;\n\n})(window, jQuery);\n","'use strict';\n\nvar Resource = (function (window, $, undefined) {\n\n  var _config;\n  var _url;\n\n  function Resource(config) {\n    _config = config;\n    _url = 'https://api.instagram.com/v1/' + _config.endpoint + '/media/recent/';\n  }\n\n  Resource.prototype = {\n\n    load: function () {\n      if (!_url) {\n        return;\n      }\n\n      var self = this;\n      var deferred = $.Deferred();\n\n      $.ajax({\n        type: 'POST',\n        url: _url,\n        data: {\n          access_token: _config.access_token,\n          count: _config.count,\n        },\n        dataType: 'jsonp',\n      }).success(function (response) {\n        $(self).trigger('loaded', [ response.data ]);\n        deferred.resolve(response.data);\n        if (!_config.loop) {\n          // Used for testing\n          _url = response.pagination && response.pagination.next_url ? response.pagination.next_url : false;\n        }\n      }).error(function () {\n        deferred.reject('Error fetching data');\n      });\n\n      return deferred.promise();\n    },\n\n    on: function (name, callback) {\n      $(this).on(name, function (event, data) {\n        callback(data);\n      });\n    },\n\n  };\n\n  return Resource;\n\n})(window, jQuery);\n","'use strict';\n\nvar Tile = (function (window, $, undefined) {\n\n  var\n    _$object,\n    _data,\n    _config,\n    _NO_DATA = 'NO_DATA';\n\n  function Tile(data, config) {\n    _data = data;\n    _config = config;\n    this.parseLocation();\n    this.create();\n  }\n\n  Tile.prototype = {\n\n    create: function () {\n      _$object = $('<a>').attr({\n        tabindex: 0,\n        class: 'masongram-image-container masongram-image-size-' + _config.size,\n      });\n\n      var $img = $('<img>').attr({\n        src: _data.images[ _config.size ].url,\n        width: _data.images[ _config.size ].width,\n        height: _data.images[ _config.size ].height,\n        class: 'masongram-image',\n      });\n\n      $img.appendTo(_$object);\n\n      var $captionContainer = $('<div>', {\n        class: 'masongram-image-caption-container',\n      });\n\n      var $caption = $('<div>', {\n        class: 'masongram-image-caption',\n      });\n\n      if (_data.caption && _data.caption.text) {\n        $caption.html(this.parseCaption());\n      }\n\n      $caption.appendTo($captionContainer);\n      $captionContainer.appendTo(_$object);\n    },\n\n    getObject: function () {\n      return _$object;\n    },\n\n    parseLocation: function () {\n      if (_data.caption && _data.caption.text && /@[\\d]+\\.[\\d]+,[\\d]+\\.[\\d]+/.test(_data.caption.text)) {\n        var location = _data.caption.text.match(/@([\\d]+\\.[\\d]+),([\\d]+\\.[\\d]+)/);\n        _data.caption.text = _data.caption.text.replace(/\\s*@([\\d]+\\.[\\d]+),([\\d]+\\.[\\d]+)/, '');\n        _data.location = {\n          latitude: location[ 1 ],\n          longitude: location[ 2 ],\n        };\n      }\n    },\n\n    parseCaption: function () {\n      var html = _config.caption;\n\n      if (/{.*}/.test(html)) {\n        var matches = html.match(/{([^}]+)}/g);\n        matches.forEach(function (match) {\n          switch (match) {\n            case '{location}':\n              html = html.replace(match, _data.location && _data.location.latitude !== undefined && _data.location.longitude !== undefined ? (_data.location.latitude + ',' + _data.location.longitude) : _NO_DATA);\n              break;\n            case '{latitude}':\n              html = html.replace(match, _data.location && _data.location.latitude !== undefined ? _data.location.latitude : _NO_DATA);\n              break;\n            case '{longitude}':\n              html = html.replace(match, _data.location && _data.location.longitude !== undefined ? _data.location.longitude : _NO_DATA);\n              break;\n            case '{caption}':\n              html = html.replace(match, _data.caption && _data.caption.text !== undefined ? _data.caption.text : _NO_DATA);\n              break;\n            case '{likes}':\n              html = html.replace(match, _data.likes && _data.likes.count !== undefined ? _data.likes.count : _NO_DATA);\n              break;\n            case '{link}':\n              html = html.replace(match, _data.link ? _data.link : _NO_DATA);\n              break;\n          }\n        });\n      }\n\n      return html;\n    },\n\n  };\n\n  return Tile;\n\n})(window, jQuery);\n"]}