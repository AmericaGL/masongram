!function(a,t,e){a.masongram=e.fn.masongram=function(n){if(!n.access_token){if(!/access_token/.test(a.location.search))return console.warn('Missing required option "access_token". Read more at https://github.com/mladenplavsic/masongram'),this;n.access_token=a.location.search.replace(/.*access_token=([\w.]+).*/i,"$1")}a.location.hash&&(n.endpoint="tags/"+a.location.hash.substr(1));var o=e.extend(!0,{endpoint:"users/self",count:10,offset:100,columnWidth:324,loop:!1,map:"https://www.google.com/maps?q={latitude},{longitude}",title:"{caption} {map} {author} {likes}"},n);return this.each(function(){var n=this,i=e("<div>").attr({class:"masongram-container"}).appendTo(n);e("<div>").attr({class:"masongram-image-sizer"}).appendTo(i),i.find(".masongram-image-container").fancybox({loop:!1,helpers:{overlay:{locked:!1}},afterLoad:function(){var a=i.find(".masongram-image-container").eq(this.index).data("object");this.title=o.title,this.title=a.caption?this.title.replace(/\{caption}/gi,a.caption.text.replace(/#([^\s]+)/g,"<a onclick=\"masongram.filter('$1')\">#$1</a>").replace(/@([^\s]+)/g,'<a href="https://www.instagram.com/$1" target="_blank">@$1</a>')):"",this.title=this.title.replace(/\{map}/gi,a.location?'<a href="'+o.map.replace(/\{latitude}/g,a.location.latitude).replace(/\{longitude}/g,a.location.longitude)+'" target="_blank">map</a>':""),this.title=this.title.replace(/\{likes}/gi,a.user_has_liked?"&#9829;":"&#9825; "+a.likes.count),this.title=this.title.replace(/\{author}/gi,'<a href="https://www.instagram.com/'+a.user.username+'" target="_blank" title="'+a.user.full_name+'">@'+a.user.username+"</a>")},afterShow:function(){if(e("html, body").animate({scrollTop:i.find(".masongram-image-container").eq(this.index).offset().top}),this.index==this.group.length-1&&this.index!=i.find(".masongram-image-container").length-1){var a=i.find(".masongram-image-container").eq(this.index+1);this.group.push({href:a.attr("href"),type:"image"})}}}),i.masonry({itemSelector:".masongram-image-container",columnWidth:".masongram-image-sizer",percentPosition:!0});var s=function(){function t(a){if(!c){if(c=!0,!r.next_url){if(!o.loop)return void a();r.next_url="https://api.instagram.com/v1/"+o.endpoint+"/media/recent/"}e.ajax({type:"POST",url:r.next_url,data:{access_token:o.access_token,count:o.count},dataType:"jsonp",success:function(t){r=t.pagination,a(t.data,t.pagination&&t.pagination.next_url)},error:function(a){console.warn(a.statusText)},complete:function(){c=!1}})}}function s(t){var n=e("<a>").attr({href:t.images.standard_resolution.url,rel:"masongram",target:"_blank",class:"masongram-image-container"});if(e("<img>").attr({src:t.images.low_resolution.url,width:t.images.low_resolution.width,height:t.images.low_resolution.height,class:"masongram-image"}).appendTo(n),t.caption){var o=e("<div>").attr({class:"masongram-image-caption-container"});e("<div>").attr({class:"masongram-image-caption"}).html(t.caption.text).appendTo(o),n.append(o)}n.hide(),n.data("object",t),i.append(n),n.imagesLoaded().progress(function(){n.show(),i.data("masonry").appended(n),e(a).trigger("scroll")})}var r={next_url:"https://api.instagram.com/v1/"+o.endpoint+"/media/recent/"},c=!1;return{append:function(){t(function(a,t){a&&a.forEach(function(r,c){s(r),o.loop||i.on("layoutComplete",function(){t||c!==a.length-1||i.imagesLoaded().progress(function(){e(n).trigger("masongram:api:end").off("masongram:api:end")})})})})}}}();s.append(),e(a).scroll(function(){i.imagesLoaded().progress(function(){e(a).scrollTop()+e(a).height()>e(t).height()-o.offset&&s.append()})}),i.on("layoutComplete",function(){i.imagesLoaded().progress(function(){e("body").height()<e(a).height()&&s.append()})})})},a.masongram.filter=function(t){a.location.hash=t},a.onhashchange=function(){e.fancybox.close(),a.location.reload()}}(window,document,jQuery);