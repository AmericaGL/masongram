!function(a,t,e){a.masongram=e.fn.masongram=function(n){if(!n.access_token){if(!/access_token/.test(a.location.search)){var o='Missing required option "access_token". Read more at https://github.com/mladenplavsic/masongram';return this.each(function(){var a=this;e(t).ready(function(){e(a).trigger("masongram:error",o).off("masongram:error")})}),console.warn(o),this}n.access_token=a.location.search.replace(/.*access_token=([\w.]+).*/i,"$1")}a.location.hash&&(n.endpoint="tags/"+a.location.hash.substr(1));var i=e.extend(!0,{endpoint:"users/self",count:10,offset:100,columnWidth:324,loop:!1,template:{title:"{caption} {likes} {author} {map}",likes:"&#9825; {likes:count}",author:'<a href="https://www.instagram.com/{author:username}" target="_blank">{author:full_name}</a>',map:'<a href="https://www.google.com/maps?q={map:latitude},{map:longitude}">map</a>'}},n);return this.each(function(){var n=this,o=e("<div>").attr({class:"masongram-container"}).appendTo(n);e("<div>").attr({class:"masongram-image-sizer"}).appendTo(o),o.find(".masongram-image-container").fancybox({loop:!1,helpers:{overlay:{locked:!1}},afterLoad:function(){var a=o.find(".masongram-image-container").eq(this.index).data("object");this.title=i.template.title,a.caption&&(this.title=this.title.replace(/\{caption}/gi,a.caption.text.replace(/#([^\s]+)/g,"<a onclick=\"masongram.filter('$1')\">#$1</a>").replace(/@([^\s]+)/g,'<a href="https://www.instagram.com/$1" target="_blank">@$1</a>'))),this.title=this.title.replace(/\{likes}/gi,i.template.likes).replace(/\{likes:count}/gi,a.likes.count),this.title=this.title.replace(/\{author}/gi,i.template.author).replace(/\{author:username}/gi,a.user.username).replace(/\{author:full_name}/gi,a.user.full_name?a.user.full_name:a.user.username),a.location&&(this.title=this.title.replace(/\{map}/gi,i.template.map).replace(/\{map:latitude}/g,a.location.latitude).replace(/\{map:longitude}/g,a.location.longitude)),this.title=this.title.replace(/\{[^}]+}/gi,"").trim()},afterShow:function(){if(e("html, body").animate({scrollTop:o.find(".masongram-image-container").eq(this.index).offset().top}),this.index==this.group.length-1&&this.index!=o.find(".masongram-image-container").length-1){var a=o.find(".masongram-image-container").eq(this.index+1);this.group.push({href:a.attr("href"),type:"image"})}}}),o.masonry({itemSelector:".masongram-image-container",columnWidth:".masongram-image-sizer",percentPosition:!0});var r=function(){function t(a){if(!c){if(c=!0,!s.next_url){if(!i.loop)return void a();s.next_url="https://api.instagram.com/v1/"+i.endpoint+"/media/recent/"}e.ajax({type:"POST",url:s.next_url,data:{access_token:i.access_token,count:i.count},dataType:"jsonp",success:function(t){s=t.pagination,a(t.data,t.pagination&&t.pagination.next_url)},error:function(a){console.warn(a.statusText)},complete:function(){c=!1}})}}function r(t){var n=e("<a>").attr({href:t.images.standard_resolution.url,rel:"masongram",target:"_blank",class:"masongram-image-container"});if(e("<img>").attr({src:t.images.low_resolution.url,width:t.images.low_resolution.width,height:t.images.low_resolution.height,class:"masongram-image"}).appendTo(n),t.caption){var i=e("<div>").attr({class:"masongram-image-caption-container"});e("<div>").attr({class:"masongram-image-caption"}).html(t.caption.text).appendTo(i),n.append(i)}n.hide(),n.data("object",t),o.append(n),n.imagesLoaded().progress(function(){n.show(),o.data("masonry").appended(n),e(a).trigger("scroll")})}var s={next_url:"https://api.instagram.com/v1/"+i.endpoint+"/media/recent/"},c=!1;return{append:function(){t(function(a,t){a&&a.forEach(function(s,c){r(s),i.loop||o.on("layoutComplete",function(){t||c!==a.length-1||o.imagesLoaded().progress(function(){e(n).trigger("masongram:api:end").off("masongram:api:end")})})})})}}}();r.append(),e(a).scroll(function(){o.imagesLoaded().progress(function(){e(a).scrollTop()+e(a).height()>e(t).height()-i.offset&&r.append()})}),o.on("layoutComplete",function(){o.imagesLoaded().progress(function(){e("body").height()<e(a).height()&&r.append()})})})},a.masongram.filter=function(t){a.location.hash=t},a.onhashchange=function(){e.fancybox.close(),a.location.reload()}}(window,document,jQuery);