!function(t,e,a){t.masongram=a.fn.masongram=function(n){var i=a.extend(!0,{access_token:"180267898.c46e184.b6475192f2734fa8a669f1c70800aa8f",endpoint:t.location.hash?"tags/"+t.location.hash.substr(1):"users/self",count:10,offset:100,columnWidth:324,loop:!1,map:"https://www.google.com/maps?q={latitude},{longitude}",title:"{caption} {map} {author} {likes}"},n);return this.each(function(){var n=this,o=e.createElement("div"),r=a(o);r.append('<div class="masongram-image-sizer">'),r.addClass("masongram-container"),r.appendTo(n),r.find(".masongram-image-container").fancybox({loop:!1,helpers:{overlay:{locked:!1}},afterLoad:function(){var t=r.find(".masongram-image-container").eq(this.index).data("object");this.title=i.title,this.title=this.title.replace(/\{caption}/gi,t.caption.text.replace(/#([^\s]+)/g,"<a onclick=\"masongram.filter('$1')\">#$1</a>").replace(/@([^\s]+)/g,'<a href="https://www.instagram.com/$1" target="_blank">@$1</a>')),this.title=this.title.replace(/\{map}/gi,t.location?'<a href="'+i.map.replace(/\{latitude}/g,t.location.latitude).replace(/\{longitude}/g,t.location.longitude)+'" target="_blank">map</a>':""),this.title=this.title.replace(/\{likes}/gi,t.user_has_liked?"&#9829;":"&#9825; "+t.likes.count),this.title=this.title.replace(/\{author}/gi,'<a href="https://www.instagram.com/'+t.user.username+'" target="_blank" title="'+t.user.full_name+'">@'+t.user.username+"</a>")},afterShow:function(){if(a("html, body").animate({scrollTop:r.find(".masongram-image-container").eq(this.index).offset().top}),this.index==this.group.length-1&&this.index!=r.find(".masongram-image-container").length-1){var t=r.find(".masongram-image-container").eq(this.index+1);this.group.push({href:t.attr("href"),type:"image"})}}}),r.masonry({itemSelector:".masongram-image-container",columnWidth:".masongram-image-sizer",percentPosition:!0});var s=function(){function o(t){if(!c){if(c=!0,!l.next_url){if(!i.loop)return void t();l.next_url="https://api.instagram.com/v1/"+i.endpoint+"/media/recent/"}a.ajax({type:"POST",url:l.next_url,data:{access_token:i.access_token,count:i.count},dataType:"jsonp",success:function(e){l=e.pagination,t(e.data,e.pagination&&e.pagination.next_url)},error:function(t){console.warn(t.statusText)},complete:function(){c=!1}})}}function s(n){var i=e.createElement("img");i.setAttribute("src",n.images.low_resolution.url),i.setAttribute("width",n.images.low_resolution.width),i.setAttribute("height",n.images.low_resolution.height),i.setAttribute("class","masongram-image");var o=e.createElement("div");o.setAttribute("class","masongram-image-caption"),o.innerHTML=n.caption.text;var s=e.createElement("div");s.setAttribute("class","masongram-image-caption-container"),s.appendChild(o);var l=e.createElement("a");l.setAttribute("href",n.images.standard_resolution.url),l.setAttribute("rel","masongram"),l.setAttribute("target","_blank"),l.setAttribute("class","masongram-image-container"),l.appendChild(i),l.appendChild(s);var c=a(l);c.hide(),c.data("object",n),r.append(c),c.imagesLoaded().progress(function(){c.show(),r.data("masonry").appended(c),a(t).trigger("scroll")})}var l={next_url:"https://api.instagram.com/v1/"+i.endpoint+"/media/recent/"},c=!1;return{append:function(){o(function(t,e){t&&t.forEach(function(o,l){s(o),i.loop||r.on("layoutComplete",function(){e||l!==t.length-1||r.imagesLoaded().progress(function(){a(n).trigger("masongram:api:end").off("masongram:api:end")})})})})}}}();s.append(),a(t).scroll(function(){r.imagesLoaded().progress(function(){a(t).scrollTop()+a(t).height()>a(e).height()-i.offset&&s.append()})}),r.on("layoutComplete",function(){r.imagesLoaded().progress(function(){a("body").height()<a(t).height()&&s.append()})})})},t.masongram.filter=function(e){t.location.hash=e},t.onhashchange=function(){a.fancybox.close(),t.location.reload()}}(window,document,jQuery);