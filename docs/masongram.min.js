"use strict";window.masongram=$.fn.masongram=function(t){return this.each(function(){new Masongram(this,t)})};var Masongram=function(){function t(t,o){var n=this;i.forEach(function(t){n.require(t)}),r||(this.configure(o),this.setup(t))}var o,n,e,a,i=["jQuery","Masonry"],r=!1;return t.prototype={require:function(t){var o=void 0!==window[t];return o||(r=!0,console.error("Dependency unavailable: "+t)),o},configure:function(t){o=$.extend(!0,{endpoint:"users/self",loop:!1,count:10,offset:10,size:"low_resolution",caption:"{caption}"},t)},setup:function(t){var a=this;n=$("<div>").attr({class:"masongram-container"}).appendTo(t),$("<div>").attr({class:"masongram-image-sizer masongram-image-size-"+o.size}).appendTo(n),n.masonry({itemSelector:".masongram-image-container",columnWidth:".masongram-image-sizer",percentPosition:!0}),e=new Resource(o),e.on("loaded",function(t){a.append(t)});var i;$(window).scroll(function(){i||(i=setTimeout(function(){n.imagesLoaded().progress(function(){$(window).scrollTop()+$(window).height()>$(document).height()*(1-o.offset/100)&&a.load()}),i=null},100))}),n.on("layoutComplete",function(){n.imagesLoaded().progress(function(){$("body").height()<$(window).height()&&a.load()})}),a.load()},load:function(){a||(a=!0,e.load())},append:function(t){t.forEach(function(e,i){var r=new Tile(e,{caption:o.caption,size:o.size}),c=r.getObject();setTimeout(function(){c.imagesLoaded().progress(function(){n.append(c).masonry("appended",c),i+1===t.length&&(a=!1,$(window).trigger("scroll"))})},200*i)})}},t}(),Resource=function(){function t(t){o=t,n="https://api.instagram.com/v1/"+o.endpoint+"/media/recent/"}var o,n;return t.prototype={load:function(){if(n){var t=this,e=$.Deferred();return $.ajax({type:"POST",url:n,data:{access_token:o.access_token,count:o.count},dataType:"jsonp"}).success(function(a){$(t).trigger("loaded",[a.data]),e.resolve(a.data),o.loop||(n=!(!a.pagination||!a.pagination.next_url)&&a.pagination.next_url)}).error(function(){e.reject("Error fetching data")}),e.promise()}},on:function(t,o){$(this).on(t,function(t,n){o(n)})}},t}(),Tile=function(){function t(t,o){n=t,e=o,this.parseLocation(),this.create()}var o,n,e,a="NO_DATA";return t.prototype={create:function(){o=$("<a>").attr({href:n.link,target:"_blank",class:"masongram-image-container masongram-image-size-"+e.size});var t=$("<img>").attr({src:n.images[e.size].url,width:n.images[e.size].width,height:n.images[e.size].height,class:"masongram-image"});t.appendTo(o);var a=$("<div>",{class:"masongram-image-caption-container"}),i=$("<div>",{class:"masongram-image-caption"});n.caption&&n.caption.text&&i.html(this.parseCaption()),i.appendTo(a),a.appendTo(o)},getObject:function(){return o},parseLocation:function(){if(n.caption&&n.caption.text&&/@[\d]+\.[\d]+,[\d]+\.[\d]+/.test(n.caption.text)){var t=n.caption.text.match(/@([\d]+\.[\d]+),([\d]+\.[\d]+)/);n.caption.text=n.caption.text.replace(/\s*@([\d]+\.[\d]+),([\d]+\.[\d]+)/,""),n.location={latitude:t[1],longitude:t[2]}}},parseCaption:function(){var t=e.caption;if(/{.*}/.test(t)){var o=t.match(/{([^}]+)}/g);o.forEach(function(o){switch(o){case"{location}":t=t.replace(o,n.location&&void 0!==n.location.latitude&&void 0!==n.location.longitude?n.location.latitude+","+n.location.longitude:a);break;case"{latitude}":t=t.replace(o,n.location&&void 0!==n.location.latitude?n.location.latitude:a);break;case"{longitude}":t=t.replace(o,n.location&&void 0!==n.location.longitude?n.location.longitude:a);break;case"{caption}":t=t.replace(o,n.caption&&void 0!==n.caption.text?n.caption.text:a);break;case"{likes}":t=t.replace(o,n.likes&&void 0!==n.likes.count?n.likes.count:a)}})}return t}},t}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluaXQuanMiLCJtYXNvbmdyYW0uanMiLCJyZXNvdW9yY2UuanMiLCJ0aWxlLmpzIl0sIm5hbWVzIjpbIndpbmRvdyIsIm1hc29uZ3JhbSIsIiQiLCJmbiIsIm9wdGlvbnMiLCJ0aGlzIiwiZWFjaCIsIk1hc29uZ3JhbSIsIiRlbGVtZW50Iiwic2VsZiIsIl9kZXBlbmRlbmNpZXMiLCJmb3JFYWNoIiwibmFtZSIsInJlcXVpcmUiLCJfZXJyb3IiLCJjb25maWd1cmUiLCJzZXR1cCIsIl8kY29udGFpbmVyIiwiX3Jlc291cmNlIiwiX2luUHJvZ3Jlc3MiLCJwcm90b3R5cGUiLCJyZXN1bHQiLCJ1bmRlZmluZWQiLCJjb25zb2xlIiwiZXJyb3IiLCJfY29uZmlnIiwiZXh0ZW5kIiwiZW5kcG9pbnQiLCJsb29wIiwiY291bnQiLCJvZmZzZXQiLCJzaXplIiwiY2FwdGlvbiIsImF0dHIiLCJjbGFzcyIsImFwcGVuZFRvIiwibWFzb25yeSIsIml0ZW1TZWxlY3RvciIsImNvbHVtbldpZHRoIiwicGVyY2VudFBvc2l0aW9uIiwiUmVzb3VyY2UiLCJvbiIsIml0ZW1zIiwiYXBwZW5kIiwic2Nyb2xsVGltZW91dCIsInNjcm9sbCIsInNldFRpbWVvdXQiLCJpbWFnZXNMb2FkZWQiLCJwcm9ncmVzcyIsInNjcm9sbFRvcCIsImhlaWdodCIsImRvY3VtZW50IiwibG9hZCIsIml0ZW0iLCJpbmRleCIsInRpbGUiLCJUaWxlIiwiJG9iamVjdCIsImdldE9iamVjdCIsImxlbmd0aCIsInRyaWdnZXIiLCJjb25maWciLCJfdXJsIiwiZGVmZXJyZWQiLCJEZWZlcnJlZCIsImFqYXgiLCJ0eXBlIiwidXJsIiwiZGF0YSIsImFjY2Vzc190b2tlbiIsImRhdGFUeXBlIiwic3VjY2VzcyIsInJlc3BvbnNlIiwicmVzb2x2ZSIsInBhZ2luYXRpb24iLCJuZXh0X3VybCIsInJlamVjdCIsInByb21pc2UiLCJjYWxsYmFjayIsImV2ZW50IiwiX2RhdGEiLCJwYXJzZUxvY2F0aW9uIiwiY3JlYXRlIiwiXyRvYmplY3QiLCJfTk9fREFUQSIsImhyZWYiLCJsaW5rIiwidGFyZ2V0IiwiJGltZyIsInNyYyIsImltYWdlcyIsIndpZHRoIiwiJGNhcHRpb25Db250YWluZXIiLCIkY2FwdGlvbiIsInRleHQiLCJodG1sIiwicGFyc2VDYXB0aW9uIiwidGVzdCIsImxvY2F0aW9uIiwibWF0Y2giLCJyZXBsYWNlIiwibGF0aXR1ZGUiLCJsb25naXR1ZGUiLCJtYXRjaGVzIiwibGlrZXMiXSwibWFwcGluZ3MiOiJBQUFBLFlBRUFBLFFBQUFDLFVBQUFDLEVBQUFDLEdBQUFGLFVBQUEsU0FBQUcsR0FDQSxNQUFBQyxNQUFBQyxLQUFBLFdBQ0EsR0FBQUMsV0FBQUYsS0FBQUQsS0FGQSxJQUFBRyxXQUFBLFdDS0EsUUFBQUEsR0FBQUMsRUFBQUosR0RQQSxHQUFBSyxHQUFBSixJQUVBSyxHQUFBQyxRQUFBLFNBQUFDLEdDU0FILEVBQUFJLFFBQUFELEtBR0FFLElBSUFULEtBQUFVLFVBQUFYLEdBQ0FDLEtBQUFXLE1BQUFSLElEZkEsR0FGQVIsR0NDQWlCLEVBQ0FDLEVBQ0FDLEVEREFULEdBQ0EsU0FDQSxXQ0xBSSxHQUFBLENBNEhBLE9BdkdBUCxHQUFBYSxXQUVBUCxRQUFBLFNBQUFELEdBQ0EsR0FBQVMsR0FBQUMsU0FBQXRCLE9BQUFZLEVBS0EsT0FKQVMsS0FDQVAsR0FBQSxFQUNBUyxRQUFBQyxNQUFBLDJCQUFBWixJQUVBUyxHQUdBTixVQUFBLFNBQUFYLEdBQ0FxQixFQUFBdkIsRUFBQXdCLFFBQUEsR0FDQUMsU0FBQSxhQUNBQyxNQUFBLEVBQ0FDLE1BQUEsR0FDQUMsT0FBQSxHQUNBQyxLQUFBLGlCQUNBQyxRQUFBLGFBQ0E1QixJQUdBWSxNQUFBLFNBQUFSLEdBQ0EsR0FBQUMsR0FBQUosSUFDQVksR0FBQWYsRUFBQSxTQUNBK0IsTUFDQUMsTUFBQSx3QkFFQUMsU0FBQTNCLEdBRUFOLEVBQUEsU0FDQStCLE1BQ0FDLE1BQUEsOENBQUFULEVBQUFNLE9BRUFJLFNBQUFsQixHQUVBQSxF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RUFBQUssUUFBQUQsRUFBQW5CLEVBQUFoRCxTQUFBVixTQUFBMEQsRUFBQWhELFFBQUE4RCxLQUFBZCxFQUFBaEQsUUFBQThELEtBQUFWLEVBQ0EsTUFDQSxLQUFBLFVBQ0FXLEVBQUFBLEVBQUFLLFFBQUFELEVBQUFuQixFQUFBd0IsT0FBQWxGLFNBQUEwRCxFQUFBd0IsTUFBQTNFLE1BQUFtRCxFQUFBd0IsTUFBQTNFLE1BQUF1RCxNQU1BLE1BQUFXLEtBS0F2QyIsImZpbGUiOiJtYXNvbmdyYW0ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG53aW5kb3cubWFzb25ncmFtID0gJC5mbi5tYXNvbmdyYW0gPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkge1xuICAgIG5ldyBNYXNvbmdyYW0odGhpcywgb3B0aW9ucyk7XG4gIH0pO1xufTtcbiIsIid1c2Ugc3RyaWN0JztcblxudmFyIE1hc29uZ3JhbSA9IChmdW5jdGlvbiAoKSB7XG5cbiAgdmFyIF9kZXBlbmRlbmNpZXMgPSBbXG4gICAgJ2pRdWVyeScsXG4gICAgJ01hc29ucnknXG4gIF07XG5cbiAgdmFyIF9lcnJvciA9IGZhbHNlO1xuICB2YXIgX2NvbmZpZztcbiAgdmFyIF8kY29udGFpbmVyO1xuICB2YXIgX3Jlc291cmNlO1xuICB2YXIgX2luUHJvZ3Jlc3M7XG5cbiAgZnVuY3Rpb24gTWFzb25ncmFtKCRlbGVtZW50LCBvcHRpb25zKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgX2RlcGVuZGVuY2llcy5mb3JFYWNoKGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICBzZWxmLnJlcXVpcmUobmFtZSk7XG4gICAgfSk7XG5cbiAgICBpZiAoX2Vycm9yKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5jb25maWd1cmUob3B0aW9ucyk7XG4gICAgdGhpcy5zZXR1cCgkZWxlbWVudCk7XG4gIH1cblxuICBNYXNvbmdyYW0ucHJvdG90eXBlID0ge1xuXG4gICAgcmVxdWlyZTogZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgIHZhciByZXN1bHQgPSB3aW5kb3dbbmFtZV0gIT09IHVuZGVmaW5lZDtcbiAgICAgIGlmICghcmVzdWx0KSB7XG4gICAgICAgIF9lcnJvciA9IHRydWU7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0RlcGVuZGVuY3kgdW5hdmFpbGFibGU6ICcgKyBuYW1lKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSxcblxuICAgIGNvbmZpZ3VyZTogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgIF9jb25maWcgPSAkLmV4dGVuZCh0cnVlLCB7XG4gICAgICAgIGVuZHBvaW50OiAndXNlcnMvc2VsZicsXG4gICAgICAgIGxvb3A6IGZhbHNlLFxuICAgICAgICBjb3VudDogMTAsXG4gICAgICAgIG9mZnNldDogMTAsXG4gICAgICAgIHNpemU6ICdsb3dfcmVzb2x1dGlvbicsXG4gICAgICAgIGNhcHRpb246ICd7Y2FwdGlvbn0nXG4gICAgICB9LCBvcHRpb25zICk7XG4gICAgfSxcblxuICAgIHNldHVwOiBmdW5jdGlvbiAoJGVsZW1lbnQpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgIF8kY29udGFpbmVyID0gJCgnPGRpdj4nKVxuICAgICAgICAuYXR0cih7XG4gICAgICAgICAgY2xhc3M6ICdtYXNvbmdyYW0tY29udGFpbmVyJ1xuICAgICAgICB9KVxuICAgICAgICAuYXBwZW5kVG8oJGVsZW1lbnQpO1xuXG4gICAgICAkKCc8ZGl2PicpXG4gICAgICAgIC5hdHRyKHtcbiAgICAgICAgICBjbGFzczogJ21hc29uZ3JhbS1pbWFnZS1zaXplciBtYXNvbmdyYW0taW1hZ2Utc2l6ZS0nICsgX2NvbmZpZy5zaXplXG4gICAgICAgIH0pXG4gICAgICAgIC5hcHBlbmRUbyhfJGNvbnRhaW5lcik7XG5cbiAgICAgIF8kY29udGFpbmVyLm1hc29ucnkoe1xuICAgICAgICBpdGVtU2VsZWN0b3I6ICcubWFzb25ncmFtLWltYWdlLWNvbnRhaW5lcicsXG4gICAgICAgIGNvbHVtbldpZHRoOiAnLm1hc29uZ3JhbS1pbWFnZS1zaXplcicsXG4gICAgICAgIHBlcmNlbnRQb3NpdGlvbjogdHJ1ZVxuICAgICAgfSk7XG5cbiAgICAgIF9yZXNvdXJjZSA9IG5ldyBSZXNvdXJjZShfY29uZmlnKTtcblxuICAgICAgX3Jlc291cmNlLm9uKCdsb2FkZWQnLCBmdW5jdGlvbiAoaXRlbXMpIHtcbiAgICAgICAgc2VsZi5hcHBlbmQoaXRlbXMpXG4gICAgICB9KTtcblxuICAgICAgLy8gbG9hZCBpbWFnZXMgd2hlbiBzY3JvbGxlZCBjbG9zZSB0byBib3R0b21cbiAgICAgIHZhciBzY3JvbGxUaW1lb3V0Oy8vIHRocm90dGxlXG4gICAgICAkKHdpbmRvdykuc2Nyb2xsKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCFzY3JvbGxUaW1lb3V0KSB7XG4gICAgICAgICAgc2Nyb2xsVGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgXyRjb250YWluZXIuaW1hZ2VzTG9hZGVkKCkucHJvZ3Jlc3MoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICBpZiAoJCh3aW5kb3cpLnNjcm9sbFRvcCgpICsgJCh3aW5kb3cpLmhlaWdodCgpID4gJChkb2N1bWVudCkuaGVpZ2h0KCkgKiAoMSAtIF9jb25maWcub2Zmc2V0LzEwMCkpIHtcbiAgICAgICAgICAgICAgICBzZWxmLmxvYWQoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzY3JvbGxUaW1lb3V0ID0gbnVsbDtcbiAgICAgICAgICB9LCAxMDApO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgLy8gZmlsbCB3aW5kb3cgaWYgdGhlcmUgaXMgd2hpdGUgc3BhY2UgbGVmdFxuICAgICAgXyRjb250YWluZXIub24oJ2xheW91dENvbXBsZXRlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBfJGNvbnRhaW5lci5pbWFnZXNMb2FkZWQoKS5wcm9ncmVzcyhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgaWYgKCQoJ2JvZHknKS5oZWlnaHQoKSA8ICQod2luZG93KS5oZWlnaHQoKSkge1xuICAgICAgICAgICAgc2VsZi5sb2FkKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgfSk7XG5cbiAgICAgIHNlbGYubG9hZCgpO1xuICAgIH0sXG5cbiAgICBsb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoX2luUHJvZ3Jlc3MpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgX2luUHJvZ3Jlc3MgPSB0cnVlO1xuICAgICAgX3Jlc291cmNlLmxvYWQoKTtcbiAgICB9LFxuXG4gICAgYXBwZW5kOiBmdW5jdGlvbiAoaXRlbXMpIHtcbiAgICAgIGl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7XG4gICAgICAgIHZhciB0aWxlID0gbmV3IFRpbGUoaXRlbSwge1xuICAgICAgICAgIGNhcHRpb246IF9jb25maWcuY2FwdGlvbixcbiAgICAgICAgICBzaXplOiBfY29uZmlnLnNpemVcbiAgICAgICAgfSk7XG4gICAgICAgIHZhciAkb2JqZWN0ID0gdGlsZS5nZXRPYmplY3QoKTtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgJG9iamVjdC5pbWFnZXNMb2FkZWQoKS5wcm9ncmVzcyhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfJGNvbnRhaW5lci5hcHBlbmQoJG9iamVjdCkubWFzb25yeSgnYXBwZW5kZWQnLCAkb2JqZWN0KTtcbiAgICAgICAgICAgIGlmIChpbmRleCArIDEgPT09IGl0ZW1zLmxlbmd0aCkge1xuICAgICAgICAgICAgICBfaW5Qcm9ncmVzcyA9IGZhbHNlO1xuICAgICAgICAgICAgICAkKHdpbmRvdykudHJpZ2dlcignc2Nyb2xsJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sIGluZGV4ICogMjAwKTtcbiAgICAgIH0pXG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBNYXNvbmdyYW07XG5cbn0pKCk7XG4iLCIndXNlIHN0cmljdCc7XG5cbnZhciBSZXNvdXJjZSA9IChmdW5jdGlvbiAoKSB7XG5cbiAgdmFyIF9jb25maWc7XG4gIHZhciBfdXJsO1xuXG4gIGZ1bmN0aW9uIFJlc291cmNlKGNvbmZpZykge1xuICAgIF9jb25maWcgPSBjb25maWc7XG4gICAgX3VybCA9ICdodHRwczovL2FwaS5pbnN0YWdyYW0uY29tL3YxLycgKyBfY29uZmlnLmVuZHBvaW50ICsgJy9tZWRpYS9yZWNlbnQvJztcbiAgfVxuXG4gIFJlc291cmNlLnByb3RvdHlwZSA9IHtcblxuICAgIGxvYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICghX3VybCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgIHZhciBkZWZlcnJlZCA9ICQuRGVmZXJyZWQoKTtcblxuICAgICAgJC5hamF4KHtcbiAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICB1cmw6IF91cmwsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBhY2Nlc3NfdG9rZW46IF9jb25maWcuYWNjZXNzX3Rva2VuLFxuICAgICAgICAgIGNvdW50OiBfY29uZmlnLmNvdW50XG4gICAgICAgIH0sXG4gICAgICAgIGRhdGFUeXBlOiAnanNvbnAnXG4gICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAkKHNlbGYpLnRyaWdnZXIoJ2xvYWRlZCcsIFtyZXNwb25zZS5kYXRhXSk7XG4gICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UuZGF0YSk7XG4gICAgICAgIGlmICghX2NvbmZpZy5sb29wKSB7XG4gICAgICAgICAgLy8gVXNlZCBmb3IgdGVzdGluZ1xuICAgICAgICAgIF91cmwgPSByZXNwb25zZS5wYWdpbmF0aW9uICYmIHJlc3BvbnNlLnBhZ2luYXRpb24ubmV4dF91cmwgPyByZXNwb25zZS5wYWdpbmF0aW9uLm5leHRfdXJsIDogZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH0pLmVycm9yKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZGVmZXJyZWQucmVqZWN0KCdFcnJvciBmZXRjaGluZyBkYXRhJylcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZSgpO1xuICAgIH0sXG5cbiAgICBvbjogZnVuY3Rpb24gKG5hbWUsIGNhbGxiYWNrKSB7XG4gICAgICAkKHRoaXMpLm9uKG5hbWUsIGZ1bmN0aW9uIChldmVudCwgZGF0YSkge1xuICAgICAgICBjYWxsYmFjayhkYXRhKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICB9O1xuXG4gIHJldHVybiBSZXNvdXJjZTtcblxufSkoKTtcbiIsIid1c2Ugc3RyaWN0JztcblxudmFyIFRpbGUgPSAoZnVuY3Rpb24gKCkge1xuXG4gIHZhclxuICAgIF8kb2JqZWN0LFxuICAgIF9kYXRhLFxuICAgIF9jb25maWcsXG4gICAgX05PX0RBVEEgPSAnTk9fREFUQSc7XG5cbiAgZnVuY3Rpb24gVGlsZShkYXRhLCBjb25maWcpIHtcbiAgICBfZGF0YSA9IGRhdGE7XG4gICAgX2NvbmZpZyA9IGNvbmZpZztcbiAgICB0aGlzLnBhcnNlTG9jYXRpb24oKTtcbiAgICB0aGlzLmNyZWF0ZSgpO1xuICB9XG5cbiAgVGlsZS5wcm90b3R5cGUgPSB7XG5cbiAgICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgIF8kb2JqZWN0ID0gJCgnPGE+JykuYXR0cih7XG4gICAgICAgIGhyZWY6IF9kYXRhLmxpbmssXG4gICAgICAgIHRhcmdldDogJ19ibGFuaycsXG4gICAgICAgIGNsYXNzOiAnbWFzb25ncmFtLWltYWdlLWNvbnRhaW5lciBtYXNvbmdyYW0taW1hZ2Utc2l6ZS0nICsgX2NvbmZpZy5zaXplXG4gICAgICB9KTtcblxuICAgICAgdmFyICRpbWcgPSAkKCc8aW1nPicpLmF0dHIoe1xuICAgICAgICBzcmM6IF9kYXRhLmltYWdlc1tfY29uZmlnLnNpemVdLnVybCxcbiAgICAgICAgd2lkdGg6IF9kYXRhLmltYWdlc1tfY29uZmlnLnNpemVdLndpZHRoLFxuICAgICAgICBoZWlnaHQ6IF9kYXRhLmltYWdlc1tfY29uZmlnLnNpemVdLmhlaWdodCxcbiAgICAgICAgY2xhc3M6ICdtYXNvbmdyYW0taW1hZ2UnXG4gICAgICB9KTtcblxuICAgICAgJGltZy5hcHBlbmRUbyhfJG9iamVjdCk7XG5cbiAgICAgIHZhciAkY2FwdGlvbkNvbnRhaW5lciA9ICQoJzxkaXY+Jywge1xuICAgICAgICBjbGFzczogJ21hc29uZ3JhbS1pbWFnZS1jYXB0aW9uLWNvbnRhaW5lcidcbiAgICAgIH0pO1xuXG4gICAgICB2YXIgJGNhcHRpb24gPSAkKCc8ZGl2PicsIHtcbiAgICAgICAgY2xhc3M6ICdtYXNvbmdyYW0taW1hZ2UtY2FwdGlvbidcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoX2RhdGEuY2FwdGlvbiAmJiBfZGF0YS5jYXB0aW9uLnRleHQpIHtcbiAgICAgICAgJGNhcHRpb24uaHRtbCh0aGlzLnBhcnNlQ2FwdGlvbigpKTtcbiAgICAgIH1cblxuICAgICAgJGNhcHRpb24uYXBwZW5kVG8oJGNhcHRpb25Db250YWluZXIpO1xuICAgICAgJGNhcHRpb25Db250YWluZXIuYXBwZW5kVG8oXyRvYmplY3QpO1xuICAgIH0sXG5cbiAgICBnZXRPYmplY3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBfJG9iamVjdDtcbiAgICB9LFxuXG4gICAgcGFyc2VMb2NhdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKF9kYXRhLmNhcHRpb24gJiYgX2RhdGEuY2FwdGlvbi50ZXh0ICYmIC9AW1xcZF0rXFwuW1xcZF0rLFtcXGRdK1xcLltcXGRdKy8udGVzdChfZGF0YS5jYXB0aW9uLnRleHQpKSB7XG4gICAgICAgIHZhciBsb2NhdGlvbiA9IF9kYXRhLmNhcHRpb24udGV4dC5tYXRjaCgvQChbXFxkXStcXC5bXFxkXSspLChbXFxkXStcXC5bXFxkXSspLyk7XG4gICAgICAgIF9kYXRhLmNhcHRpb24udGV4dCA9IF9kYXRhLmNhcHRpb24udGV4dC5yZXBsYWNlKC9cXHMqQChbXFxkXStcXC5bXFxkXSspLChbXFxkXStcXC5bXFxkXSspLywgJycpO1xuICAgICAgICBfZGF0YS5sb2NhdGlvbiA9IHtcbiAgICAgICAgICBsYXRpdHVkZTogbG9jYXRpb25bMV0sXG4gICAgICAgICAgbG9uZ2l0dWRlOiBsb2NhdGlvblsyXVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBwYXJzZUNhcHRpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBodG1sID0gX2NvbmZpZy5jYXB0aW9uO1xuXG4gICAgICBpZiAoL3suKn0vLnRlc3QoaHRtbCkpIHtcbiAgICAgICAgdmFyIG1hdGNoZXMgPSBodG1sLm1hdGNoKC97KFtefV0rKX0vZyk7XG4gICAgICAgIG1hdGNoZXMuZm9yRWFjaChmdW5jdGlvbiAobWF0Y2gpIHtcbiAgICAgICAgICBzd2l0Y2ggKG1hdGNoKSB7XG4gICAgICAgICAgICBjYXNlICd7bG9jYXRpb259JzpcbiAgICAgICAgICAgICAgaHRtbCA9IGh0bWwucmVwbGFjZShtYXRjaCwgX2RhdGEubG9jYXRpb24gJiYgX2RhdGEubG9jYXRpb24ubGF0aXR1ZGUgIT09IHVuZGVmaW5lZCAmJiBfZGF0YS5sb2NhdGlvbi5sb25naXR1ZGUgIT09IHVuZGVmaW5lZCA/IChfZGF0YS5sb2NhdGlvbi5sYXRpdHVkZSArICcsJyArIF9kYXRhLmxvY2F0aW9uLmxvbmdpdHVkZSkgOiBfTk9fREFUQSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAne2xhdGl0dWRlfSc6XG4gICAgICAgICAgICAgIGh0bWwgPSBodG1sLnJlcGxhY2UobWF0Y2gsIF9kYXRhLmxvY2F0aW9uICYmIF9kYXRhLmxvY2F0aW9uLmxhdGl0dWRlICE9PSB1bmRlZmluZWQgPyBfZGF0YS5sb2NhdGlvbi5sYXRpdHVkZSA6IF9OT19EQVRBKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd7bG9uZ2l0dWRlfSc6XG4gICAgICAgICAgICAgIGh0bWwgPSBodG1sLnJlcGxhY2UobWF0Y2gsIF9kYXRhLmxvY2F0aW9uICYmIF9kYXRhLmxvY2F0aW9uLmxvbmdpdHVkZSAhPT0gdW5kZWZpbmVkID8gX2RhdGEubG9jYXRpb24ubG9uZ2l0dWRlIDogX05PX0RBVEEpO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3tjYXB0aW9ufSc6XG4gICAgICAgICAgICAgIGh0bWwgPSBodG1sLnJlcGxhY2UobWF0Y2gsIF9kYXRhLmNhcHRpb24gJiYgX2RhdGEuY2FwdGlvbi50ZXh0ICE9PSB1bmRlZmluZWQgPyBfZGF0YS5jYXB0aW9uLnRleHQgOiBfTk9fREFUQSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAne2xpa2VzfSc6XG4gICAgICAgICAgICAgIGh0bWwgPSBodG1sLnJlcGxhY2UobWF0Y2gsIF9kYXRhLmxpa2VzICYmIF9kYXRhLmxpa2VzLmNvdW50ICE9PSB1bmRlZmluZWQgPyBfZGF0YS5saWtlcy5jb3VudCA6IF9OT19EQVRBKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGh0bWw7XG4gICAgfVxuXG4gIH07XG5cbiAgcmV0dXJuIFRpbGU7XG5cbn0pKCk7XG4iXX0=
