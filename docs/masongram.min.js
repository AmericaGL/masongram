"use strict";window.masongram=$.fn.masongram=function(t){return this.each(function(){new Masongram(this,t)})};var Masongram=function(){function t(t,o){var n=this;i.forEach(function(t){n.require(t)}),r||(this.configure(o),this.setup(t))}var o,n,e,a,i=["jQuery","Masonry"],r=!1;return t.prototype={require:function(t){var o=void 0!==window[t];return o||(r=!0,console.error("Dependency unavailable: "+t)),o},configure:function(t){o=$.extend(!0,{endpoint:"users/self",loop:!1,count:10,offset:10,size:"low_resolution",caption:"{caption}"},t)},setup:function(t){var a=this;n=$("<div>").attr({class:"masongram-container"}).appendTo(t),$("<div>").attr({class:"masongram-image-sizer masongram-image-size-"+o.size}).appendTo(n),n.masonry({itemSelector:".masongram-image-container",columnWidth:".masongram-image-sizer",percentPosition:!0}),e=new Resource(o),e.on("loaded",function(t){a.append(t)});var i;$(window).scroll(function(){i||(i=setTimeout(function(){n.imagesLoaded().progress(function(){$(window).scrollTop()+$(window).height()>$(document).height()*(1-o.offset/100)&&a.load()}),i=null},100))}),n.on("layoutComplete",function(){n.imagesLoaded().progress(function(){$("body").height()<$(window).height()&&a.load()})}),a.load()},load:function(){a||(a=!0,e.load())},append:function(t){t.forEach(function(e,i){var r=new Tile(e,{caption:o.caption,size:o.size}),c=r.getObject();setTimeout(function(){c.imagesLoaded().progress(function(){n.append(c).masonry("appended",c),i+1===t.length&&(a=!1,$(window).trigger("scroll"))})},200*i)})}},t}(),Resource=function(){function t(t){o=t,n="https://api.instagram.com/v1/"+o.endpoint+"/media/recent/"}var o,n;return t.prototype={load:function(){if(n){var t=this,e=$.Deferred();return $.ajax({type:"POST",url:n,data:{access_token:o.access_token,count:o.count},dataType:"jsonp"}).success(function(a){$(t).trigger("loaded",[a.data]),e.resolve(a.data),o.loop||(n=!(!a.pagination||!a.pagination.next_url)&&a.pagination.next_url)}).error(function(){e.reject("Error fetching data")}),e.promise()}},on:function(t,o){$(this).on(t,function(t,n){o(n)})}},t}(),Tile=function(){function t(t,o){n=t,e=o,this.parseLocation(),this.create()}var o,n,e,a="NO_DATA";return t.prototype={create:function(){o=$("<a>").attr({href:n.link,target:"_blank",class:"masongram-image-container masongram-image-size-"+e.size});var t=$("<img>").attr({src:n.images[e.size].url,width:n.images[e.size].width,height:n.images[e.size].height,class:"masongram-image"});t.appendTo(o);var a=$("<div>",{class:"masongram-image-caption-container"}),i=$("<div>",{class:"masongram-image-caption"});n.caption&&n.caption.text&&i.html(this.parseCaption()),i.appendTo(a),a.appendTo(o)},getObject:function(){return o},parseLocation:function(){if(n.caption&&n.caption.text&&/@[\d]+\.[\d]+,[\d]+\.[\d]+/.test(n.caption.text)){var t=n.caption.text.match(/@([\d]+\.[\d]+),([\d]+\.[\d]+)/);n.caption.text=n.caption.text.replace(/\s*@([\d]+\.[\d]+),([\d]+\.[\d]+)/,""),n.location={latitude:t[1],longitude:t[2]}}},parseCaption:function(){var t=e.caption;if(/{.*}/.test(t)){var o=t.match(/{([^}]+)}/g);o.forEach(function(o){switch(o){case"{location}":t=t.replace(o,n.location&&void 0!==n.location.latitude&&void 0!==n.location.longitude?n.location.latitude+","+n.location.longitude:a);break;case"{latitude}":t=t.replace(o,n.location&&void 0!==n.location.latitude?n.location.latitude:a);break;case"{longitude}":t=t.replace(o,n.location&&void 0!==n.location.longitude?n.location.longitude:a);break;case"{caption}":t=t.replace(o,n.caption&&void 0!==n.caption.text?n.caption.text:a);break;case"{likes}":t=t.replace(o,n.likes&&void 0!==n.likes.count?n.likes.count:a)}})}return t}},t}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluaXQuanMiLCJtYXNvbmdyYW0uanMiLCJyZXNvdW9yY2UuanMiLCJ0aWxlLmpzIl0sIm5hbWVzIjpbIndpbmRvdyIsIm1hc29uZ3JhbSIsIiQiLCJmbiIsIm9wdGlvbnMiLCJ0aGlzIiwiZWFjaCIsIk1hc29uZ3JhbSIsIiRlbGVtZW50Iiwic2VsZiIsIl9kZXBlbmRlbmNpZXMiLCJmb3JFYWNoIiwibmFtZSIsInJlcXVpcmUiLCJfZXJyb3IiLCJjb25maWd1cmUiLCJzZXR1cCIsIl8kY29udGFpbmVyIiwiX3Jlc291cmNlIiwiX2luUHJvZ3Jlc3MiLCJwcm90b3R5cGUiLCJyZXN1bHQiLCJ1bmRlZmluZWQiLCJjb25zb2xlIiwiZXJyb3IiLCJfY29uZmlnIiwiZXh0ZW5kIiwiZW5kcG9pbnQiLCJsb29wIiwiY291bnQiLCJvZmZzZXQiLCJzaXplIiwiY2FwdGlvbiIsImF0dHIiLCJjbGFzcyIsImFwcGVuZFRvIiwibWFzb25yeSIsIml0ZW1TZWxlY3RvciIsImNvbHVtbldpZHRoIiwicGVyY2VudFBvc2l0aW9uIiwiUmVzb3VyY2UiLCJvbiIsIml0ZW1zIiwiYXBwZW5kIiwic2Nyb2xsVGltZW91dCIsInNjcm9sbCIsInNldFRpbWVvdXQiLCJpbWFnZXNMb2FkZWQiLCJwcm9ncmVzcyIsInNjcm9sbFRvcCIsImhlaWdodCIsImRvY3VtZW50IiwibG9hZCIsIml0ZW0iLCJpbmRleCIsInRpbGUiLCJUaWxlIiwiJG9iamVjdCIsImdldE9iamVjdCIsImxlbmd0aCIsInRyaWdnZXIiLCJjb25maWciLCJfdXJsIiwiZGVmZXJyZWQiLCJEZWZlcnJlZCIsImFqYXgiLCJ0eXBlIiwidXJsIiwiZGF0YSIsImFjY2Vzc190b2tlbiIsImRhdGFUeXBlIiwic3VjY2VzcyIsInJlc3BvbnNlIiwicmVzb2x2ZSIsInBhZ2luYXRpb24iLCJuZXh0X3VybCIsInJlamVjdCIsInByb21pc2UiLCJjYWxsYmFjayIsImV2ZW50IiwiX2RhdGEiLCJwYXJzZUxvY2F0aW9uIiwiY3JlYXRlIiwiXyRvYmplY3QiLCJfTk9fREFUQSIsImhyZWYiLCJsaW5rIiwidGFyZ2V0IiwiJGltZyIsInNyYyIsImltYWdlcyIsIndpZHRoIiwiJGNhcHRpb25Db250YWluZXIiLCIkY2FwdGlvbiIsInRleHQiLCJodG1sIiwicGFyc2VDYXB0aW9uIiwidGVzdCIsImxvY2F0aW9uIiwibWF0Y2giLCJyZXBsYWNlIiwibGF0aXR1ZGUiLCJsb25naXR1ZGUiLCJtYXRjaGVzIiwibGlrZXMiXSwibWFwcGluZ3MiOiJBQUFBLFlBRUFBLFFBQUFDLFVBQUFDLEVBQUFDLEdBQUFGLFVBQUEsU0FBQUcsR0FDQSxNQUFBQyxNQUFBQyxLQUFBLFdBQ0EsR0FBQUMsV0FBQUYsS0FBQUQsS0FGQSxJQUFBRyxXQUFBLFdDS0EsUUFBQUEsR0FBQUMsRUFBQUosR0RQQSxHQUFBSyxHQUFBSixJQUVBSyxHQUFBQyxRQUFBLFNBQUFDLEdDU0FILEVBQUFJLFFBQUFELEtBR0FFLElBSUFULEtBQUFVLFVBQUFYLEdBQ0FDLEtBQUFXLE1BQUFSLElEZkEsR0FGQVIsR0NDQWlCLEVBQ0FDLEVBQ0FDLEVEREFULEdBQ0EsU0FDQSxXQ0xBSSxHQUFBLENBNEhBLE9BdkdBUCxHQUFBYSxXQUVBUCxRQUFBLFNBQUFELEdBQ0EsR0FBQVMsR0FBQUMsU0FBQXRCLE9BQUFZLEVBS0EsT0FKQVMsS0FDQVAsR0FBQSxFQUNBUyxRQUFBQyxNQUFBLDJCQUFBWixJQUVBUyxHQUdBTixVQUFBLFNBQUFYLEdBQ0FxQixFQUFBdkIsRUFBQXdCLFFBQUEsR0FDQUMsU0FBQSxhQUNBQyxNQUFBLEVBQ0FDLE1BQUEsR0FDQUMsT0FBQSxHQUNBQyxLQUFBLGlCQUNBQyxRQUFBLGFBQ0E1QixJQUdBWSxNQUFBLFNBQUFSLEdBQ0EsR0FBQUMsR0FBQUosSUFDQVksR0FBQWYsRUFBQSxTQUNBK0IsTUFDQUMsTUFBQSx3QkFFQUMsU0FBQTNCLEdBRUFOLEVBQUEsU0FDQStCLE1BQ0FDLE1BQUEsOENBQUFULEVBQUFNLE9BRUFJLFNBQUFsQixHQUVBQSxF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RUFBQUssUUFBQUQsRUFBQW5CLEVBQUFoRCxTQUFBVixTQUFBMEQsRUFBQWhELFFBQUE4RCxLQUFBZCxFQUFBaEQsUUFBQThELEtBQUFWLEVBQ0EsTUFDQSxLQUFBLFVBQ0FXLEVBQUFBLEVBQUFLLFFBQUFELEVBQUFuQixFQUFBd0IsT0FBQWxGLFNBQUEwRCxFQUFBd0IsTUFBQTNFLE1BQUFtRCxFQUFBd0IsTUFBQTNFLE1BQUF1RCxNQU1BLE1BQUFXLEtBS0F2QyIsImZpbGUiOiJtYXNvbmdyYW0ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG53aW5kb3cubWFzb25ncmFtID0gJC5mbi5tYXNvbmdyYW0gPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICBuZXcgTWFzb25ncmFtKHRoaXMsIG9wdGlvbnMpO1xuICB9KTtcbn07XG4iLCIndXNlIHN0cmljdCc7XG5cbnZhciBNYXNvbmdyYW0gPSAoZnVuY3Rpb24gKCkge1xuXG4gIHZhciBfZGVwZW5kZW5jaWVzID0gW1xuICAgICdqUXVlcnknLFxuICAgICdNYXNvbnJ5JyxcbiAgXTtcblxuICB2YXIgX2Vycm9yID0gZmFsc2U7XG4gIHZhciBfY29uZmlnO1xuICB2YXIgXyRjb250YWluZXI7XG4gIHZhciBfcmVzb3VyY2U7XG4gIHZhciBfaW5Qcm9ncmVzcztcblxuICBmdW5jdGlvbiBNYXNvbmdyYW0oJGVsZW1lbnQsIG9wdGlvbnMpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICBfZGVwZW5kZW5jaWVzLmZvckVhY2goZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgIHNlbGYucmVxdWlyZShuYW1lKTtcbiAgICB9KTtcblxuICAgIGlmIChfZXJyb3IpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmNvbmZpZ3VyZShvcHRpb25zKTtcbiAgICB0aGlzLnNldHVwKCRlbGVtZW50KTtcbiAgfVxuXG4gIE1hc29uZ3JhbS5wcm90b3R5cGUgPSB7XG5cbiAgICByZXF1aXJlOiBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgdmFyIHJlc3VsdCA9IHdpbmRvd1sgbmFtZSBdICE9PSB1bmRlZmluZWQ7XG4gICAgICBpZiAoIXJlc3VsdCkge1xuICAgICAgICBfZXJyb3IgPSB0cnVlO1xuICAgICAgICBjb25zb2xlLmVycm9yKCdEZXBlbmRlbmN5IHVuYXZhaWxhYmxlOiAnICsgbmFtZSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0sXG5cbiAgICBjb25maWd1cmU6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICBfY29uZmlnID0gJC5leHRlbmQodHJ1ZSwge1xuICAgICAgICBlbmRwb2ludDogJ3VzZXJzL3NlbGYnLFxuICAgICAgICBsb29wOiBmYWxzZSxcbiAgICAgICAgY291bnQ6IDEwLFxuICAgICAgICBvZmZzZXQ6IDEwLFxuICAgICAgICBzaXplOiAnbG93X3Jlc29sdXRpb24nLFxuICAgICAgICBjYXB0aW9uOiAne2NhcHRpb259JyxcbiAgICAgIH0sIG9wdGlvbnMpO1xuICAgIH0sXG5cbiAgICBzZXR1cDogZnVuY3Rpb24gKCRlbGVtZW50KSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICBfJGNvbnRhaW5lciA9ICQoJzxkaXY+JylcbiAgICAgICAgLmF0dHIoe1xuICAgICAgICAgIGNsYXNzOiAnbWFzb25ncmFtLWNvbnRhaW5lcicsXG4gICAgICAgIH0pXG4gICAgICAgIC5hcHBlbmRUbygkZWxlbWVudCk7XG5cbiAgICAgICQoJzxkaXY+JylcbiAgICAgICAgLmF0dHIoe1xuICAgICAgICAgIGNsYXNzOiAnbWFzb25ncmFtLWltYWdlLXNpemVyIG1hc29uZ3JhbS1pbWFnZS1zaXplLScgKyBfY29uZmlnLnNpemUsXG4gICAgICAgIH0pXG4gICAgICAgIC5hcHBlbmRUbyhfJGNvbnRhaW5lcik7XG5cbiAgICAgIF8kY29udGFpbmVyLm1hc29ucnkoe1xuICAgICAgICBpdGVtU2VsZWN0b3I6ICcubWFzb25ncmFtLWltYWdlLWNvbnRhaW5lcicsXG4gICAgICAgIGNvbHVtbldpZHRoOiAnLm1hc29uZ3JhbS1pbWFnZS1zaXplcicsXG4gICAgICAgIHBlcmNlbnRQb3NpdGlvbjogdHJ1ZSxcbiAgICAgIH0pO1xuXG4gICAgICBfcmVzb3VyY2UgPSBuZXcgUmVzb3VyY2UoX2NvbmZpZyk7XG5cbiAgICAgIF9yZXNvdXJjZS5vbignbG9hZGVkJywgZnVuY3Rpb24gKGl0ZW1zKSB7XG4gICAgICAgIHNlbGYuYXBwZW5kKGl0ZW1zKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBsb2FkIGltYWdlcyB3aGVuIHNjcm9sbGVkIGNsb3NlIHRvIGJvdHRvbVxuICAgICAgdmFyIHNjcm9sbFRpbWVvdXQ7Ly8gdGhyb3R0bGVcbiAgICAgICQod2luZG93KS5zY3JvbGwoZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIXNjcm9sbFRpbWVvdXQpIHtcbiAgICAgICAgICBzY3JvbGxUaW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfJGNvbnRhaW5lci5pbWFnZXNMb2FkZWQoKS5wcm9ncmVzcyhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIGlmICgkKHdpbmRvdykuc2Nyb2xsVG9wKCkgKyAkKHdpbmRvdykuaGVpZ2h0KCkgPiAkKGRvY3VtZW50KS5oZWlnaHQoKSAqICgxIC0gX2NvbmZpZy5vZmZzZXQgLyAxMDApKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5sb2FkKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgc2Nyb2xsVGltZW91dCA9IG51bGw7XG4gICAgICAgICAgfSwgMTAwKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIC8vIGZpbGwgd2luZG93IGlmIHRoZXJlIGlzIHdoaXRlIHNwYWNlIGxlZnRcbiAgICAgIF8kY29udGFpbmVyLm9uKCdsYXlvdXRDb21wbGV0ZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgXyRjb250YWluZXIuaW1hZ2VzTG9hZGVkKCkucHJvZ3Jlc3MoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGlmICgkKCdib2R5JykuaGVpZ2h0KCkgPCAkKHdpbmRvdykuaGVpZ2h0KCkpIHtcbiAgICAgICAgICAgIHNlbGYubG9hZCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgc2VsZi5sb2FkKCk7XG4gICAgfSxcblxuICAgIGxvYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChfaW5Qcm9ncmVzcykge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBfaW5Qcm9ncmVzcyA9IHRydWU7XG4gICAgICBfcmVzb3VyY2UubG9hZCgpO1xuICAgIH0sXG5cbiAgICBhcHBlbmQ6IGZ1bmN0aW9uIChpdGVtcykge1xuICAgICAgaXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHtcbiAgICAgICAgdmFyIHRpbGUgPSBuZXcgVGlsZShpdGVtLCB7XG4gICAgICAgICAgY2FwdGlvbjogX2NvbmZpZy5jYXB0aW9uLFxuICAgICAgICAgIHNpemU6IF9jb25maWcuc2l6ZSxcbiAgICAgICAgfSk7XG4gICAgICAgIHZhciAkb2JqZWN0ID0gdGlsZS5nZXRPYmplY3QoKTtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgJG9iamVjdC5pbWFnZXNMb2FkZWQoKS5wcm9ncmVzcyhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfJGNvbnRhaW5lci5hcHBlbmQoJG9iamVjdCkubWFzb25yeSgnYXBwZW5kZWQnLCAkb2JqZWN0KTtcbiAgICAgICAgICAgIGlmIChpbmRleCArIDEgPT09IGl0ZW1zLmxlbmd0aCkge1xuICAgICAgICAgICAgICBfaW5Qcm9ncmVzcyA9IGZhbHNlO1xuICAgICAgICAgICAgICAkKHdpbmRvdykudHJpZ2dlcignc2Nyb2xsJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sIGluZGV4ICogMjAwKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gIH07XG5cbiAgcmV0dXJuIE1hc29uZ3JhbTtcblxufSkoKTtcbiIsIid1c2Ugc3RyaWN0JztcblxudmFyIFJlc291cmNlID0gKGZ1bmN0aW9uICgpIHtcblxuICB2YXIgX2NvbmZpZztcbiAgdmFyIF91cmw7XG5cbiAgZnVuY3Rpb24gUmVzb3VyY2UoY29uZmlnKSB7XG4gICAgX2NvbmZpZyA9IGNvbmZpZztcbiAgICBfdXJsID0gJ2h0dHBzOi8vYXBpLmluc3RhZ3JhbS5jb20vdjEvJyArIF9jb25maWcuZW5kcG9pbnQgKyAnL21lZGlhL3JlY2VudC8nO1xuICB9XG5cbiAgUmVzb3VyY2UucHJvdG90eXBlID0ge1xuXG4gICAgbG9hZDogZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKCFfdXJsKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgdmFyIGRlZmVycmVkID0gJC5EZWZlcnJlZCgpO1xuXG4gICAgICAkLmFqYXgoe1xuICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgIHVybDogX3VybCxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGFjY2Vzc190b2tlbjogX2NvbmZpZy5hY2Nlc3NfdG9rZW4sXG4gICAgICAgICAgY291bnQ6IF9jb25maWcuY291bnQsXG4gICAgICAgIH0sXG4gICAgICAgIGRhdGFUeXBlOiAnanNvbnAnLFxuICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgJChzZWxmKS50cmlnZ2VyKCdsb2FkZWQnLCBbIHJlc3BvbnNlLmRhdGEgXSk7XG4gICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UuZGF0YSk7XG4gICAgICAgIGlmICghX2NvbmZpZy5sb29wKSB7XG4gICAgICAgICAgLy8gVXNlZCBmb3IgdGVzdGluZ1xuICAgICAgICAgIF91cmwgPSByZXNwb25zZS5wYWdpbmF0aW9uICYmIHJlc3BvbnNlLnBhZ2luYXRpb24ubmV4dF91cmwgPyByZXNwb25zZS5wYWdpbmF0aW9uLm5leHRfdXJsIDogZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH0pLmVycm9yKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZGVmZXJyZWQucmVqZWN0KCdFcnJvciBmZXRjaGluZyBkYXRhJyk7XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTtcbiAgICB9LFxuXG4gICAgb246IGZ1bmN0aW9uIChuYW1lLCBjYWxsYmFjaykge1xuICAgICAgJCh0aGlzKS5vbihuYW1lLCBmdW5jdGlvbiAoZXZlbnQsIGRhdGEpIHtcbiAgICAgICAgY2FsbGJhY2soZGF0YSk7XG4gICAgICB9KTtcbiAgICB9LFxuXG4gIH07XG5cbiAgcmV0dXJuIFJlc291cmNlO1xuXG59KSgpO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG52YXIgVGlsZSA9IChmdW5jdGlvbiAoKSB7XG5cbiAgdmFyXG4gICAgXyRvYmplY3QsXG4gICAgX2RhdGEsXG4gICAgX2NvbmZpZyxcbiAgICBfTk9fREFUQSA9ICdOT19EQVRBJztcblxuICBmdW5jdGlvbiBUaWxlKGRhdGEsIGNvbmZpZykge1xuICAgIF9kYXRhID0gZGF0YTtcbiAgICBfY29uZmlnID0gY29uZmlnO1xuICAgIHRoaXMucGFyc2VMb2NhdGlvbigpO1xuICAgIHRoaXMuY3JlYXRlKCk7XG4gIH1cblxuICBUaWxlLnByb3RvdHlwZSA9IHtcblxuICAgIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgXyRvYmplY3QgPSAkKCc8YT4nKS5hdHRyKHtcbiAgICAgICAgaHJlZjogX2RhdGEubGluayxcbiAgICAgICAgdGFyZ2V0OiAnX2JsYW5rJyxcbiAgICAgICAgY2xhc3M6ICdtYXNvbmdyYW0taW1hZ2UtY29udGFpbmVyIG1hc29uZ3JhbS1pbWFnZS1zaXplLScgKyBfY29uZmlnLnNpemUsXG4gICAgICB9KTtcblxuICAgICAgdmFyICRpbWcgPSAkKCc8aW1nPicpLmF0dHIoe1xuICAgICAgICBzcmM6IF9kYXRhLmltYWdlc1sgX2NvbmZpZy5zaXplIF0udXJsLFxuICAgICAgICB3aWR0aDogX2RhdGEuaW1hZ2VzWyBfY29uZmlnLnNpemUgXS53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiBfZGF0YS5pbWFnZXNbIF9jb25maWcuc2l6ZSBdLmhlaWdodCxcbiAgICAgICAgY2xhc3M6ICdtYXNvbmdyYW0taW1hZ2UnLFxuICAgICAgfSk7XG5cbiAgICAgICRpbWcuYXBwZW5kVG8oXyRvYmplY3QpO1xuXG4gICAgICB2YXIgJGNhcHRpb25Db250YWluZXIgPSAkKCc8ZGl2PicsIHtcbiAgICAgICAgY2xhc3M6ICdtYXNvbmdyYW0taW1hZ2UtY2FwdGlvbi1jb250YWluZXInLFxuICAgICAgfSk7XG5cbiAgICAgIHZhciAkY2FwdGlvbiA9ICQoJzxkaXY+Jywge1xuICAgICAgICBjbGFzczogJ21hc29uZ3JhbS1pbWFnZS1jYXB0aW9uJyxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoX2RhdGEuY2FwdGlvbiAmJiBfZGF0YS5jYXB0aW9uLnRleHQpIHtcbiAgICAgICAgJGNhcHRpb24uaHRtbCh0aGlzLnBhcnNlQ2FwdGlvbigpKTtcbiAgICAgIH1cblxuICAgICAgJGNhcHRpb24uYXBwZW5kVG8oJGNhcHRpb25Db250YWluZXIpO1xuICAgICAgJGNhcHRpb25Db250YWluZXIuYXBwZW5kVG8oXyRvYmplY3QpO1xuICAgIH0sXG5cbiAgICBnZXRPYmplY3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBfJG9iamVjdDtcbiAgICB9LFxuXG4gICAgcGFyc2VMb2NhdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKF9kYXRhLmNhcHRpb24gJiYgX2RhdGEuY2FwdGlvbi50ZXh0ICYmIC9AW1xcZF0rXFwuW1xcZF0rLFtcXGRdK1xcLltcXGRdKy8udGVzdChfZGF0YS5jYXB0aW9uLnRleHQpKSB7XG4gICAgICAgIHZhciBsb2NhdGlvbiA9IF9kYXRhLmNhcHRpb24udGV4dC5tYXRjaCgvQChbXFxkXStcXC5bXFxkXSspLChbXFxkXStcXC5bXFxkXSspLyk7XG4gICAgICAgIF9kYXRhLmNhcHRpb24udGV4dCA9IF9kYXRhLmNhcHRpb24udGV4dC5yZXBsYWNlKC9cXHMqQChbXFxkXStcXC5bXFxkXSspLChbXFxkXStcXC5bXFxkXSspLywgJycpO1xuICAgICAgICBfZGF0YS5sb2NhdGlvbiA9IHtcbiAgICAgICAgICBsYXRpdHVkZTogbG9jYXRpb25bIDEgXSxcbiAgICAgICAgICBsb25naXR1ZGU6IGxvY2F0aW9uWyAyIF0sXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfSxcblxuICAgIHBhcnNlQ2FwdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGh0bWwgPSBfY29uZmlnLmNhcHRpb247XG5cbiAgICAgIGlmICgvey4qfS8udGVzdChodG1sKSkge1xuICAgICAgICB2YXIgbWF0Y2hlcyA9IGh0bWwubWF0Y2goL3soW159XSspfS9nKTtcbiAgICAgICAgbWF0Y2hlcy5mb3JFYWNoKGZ1bmN0aW9uIChtYXRjaCkge1xuICAgICAgICAgIHN3aXRjaCAobWF0Y2gpIHtcbiAgICAgICAgICAgIGNhc2UgJ3tsb2NhdGlvbn0nOlxuICAgICAgICAgICAgICBodG1sID0gaHRtbC5yZXBsYWNlKG1hdGNoLCBfZGF0YS5sb2NhdGlvbiAmJiBfZGF0YS5sb2NhdGlvbi5sYXRpdHVkZSAhPT0gdW5kZWZpbmVkICYmIF9kYXRhLmxvY2F0aW9uLmxvbmdpdHVkZSAhPT0gdW5kZWZpbmVkID8gKF9kYXRhLmxvY2F0aW9uLmxhdGl0dWRlICsgJywnICsgX2RhdGEubG9jYXRpb24ubG9uZ2l0dWRlKSA6IF9OT19EQVRBKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd7bGF0aXR1ZGV9JzpcbiAgICAgICAgICAgICAgaHRtbCA9IGh0bWwucmVwbGFjZShtYXRjaCwgX2RhdGEubG9jYXRpb24gJiYgX2RhdGEubG9jYXRpb24ubGF0aXR1ZGUgIT09IHVuZGVmaW5lZCA/IF9kYXRhLmxvY2F0aW9uLmxhdGl0dWRlIDogX05PX0RBVEEpO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3tsb25naXR1ZGV9JzpcbiAgICAgICAgICAgICAgaHRtbCA9IGh0bWwucmVwbGFjZShtYXRjaCwgX2RhdGEubG9jYXRpb24gJiYgX2RhdGEubG9jYXRpb24ubG9uZ2l0dWRlICE9PSB1bmRlZmluZWQgPyBfZGF0YS5sb2NhdGlvbi5sb25naXR1ZGUgOiBfTk9fREFUQSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAne2NhcHRpb259JzpcbiAgICAgICAgICAgICAgaHRtbCA9IGh0bWwucmVwbGFjZShtYXRjaCwgX2RhdGEuY2FwdGlvbiAmJiBfZGF0YS5jYXB0aW9uLnRleHQgIT09IHVuZGVmaW5lZCA/IF9kYXRhLmNhcHRpb24udGV4dCA6IF9OT19EQVRBKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd7bGlrZXN9JzpcbiAgICAgICAgICAgICAgaHRtbCA9IGh0bWwucmVwbGFjZShtYXRjaCwgX2RhdGEubGlrZXMgJiYgX2RhdGEubGlrZXMuY291bnQgIT09IHVuZGVmaW5lZCA/IF9kYXRhLmxpa2VzLmNvdW50IDogX05PX0RBVEEpO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gaHRtbDtcbiAgICB9LFxuXG4gIH07XG5cbiAgcmV0dXJuIFRpbGU7XG5cbn0pKCk7XG4iXX0=
