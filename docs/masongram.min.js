"use strict";window.masongram=$.fn.masongram=function(t){return this.each(function(){new Masongram(this,t)})};var Masongram=function(){function t(t,n){var o=this;i.forEach(function(t){o.require(t)}),c||(this.configure(n),this.setup(t))}var n,o,e,a,i=["jQuery","Masonry"],c=!1;return t.prototype={require:function(t){var n=void 0!==window[t];return n||(c=!0,console.error("Dependency unavailable: "+t)),n},configure:function(t){n=$.extend(!0,{endpoint:"users/self",loop:!1,count:10,offset:10,size:"low_resolution",caption:"{caption}"},t)},setup:function(t){var a=this;o=$("<div>").attr({class:"masongram-container"}).appendTo(t),$("<div>").attr({class:"masongram-image-sizer masongram-image-size-"+n.size}).appendTo(o),o.masonry({itemSelector:".masongram-image-container",columnWidth:".masongram-image-sizer",percentPosition:!0}),e=new Resource(n),e.on("loaded",function(t){a.append(t)});var i;$(window).scroll(function(){i||(i=setTimeout(function(){o.imagesLoaded().progress(function(){$(window).scrollTop()+$(window).height()>$(document).height()*(1-n.offset/100)&&a.load()}),i=null},100))}),o.on("layoutComplete",function(){o.imagesLoaded().progress(function(){$("body").height()<$(window).height()&&a.load()})}),a.load()},load:function(){a||(a=!0,e.load())},append:function(t){t.forEach(function(e,i){var c=new Tile(e,{caption:n.caption,size:n.size}),r=c.getObject();setTimeout(function(){r.imagesLoaded().progress(function(){o.append(r).masonry("appended",r),i+1===t.length&&(a=!1,$(window).trigger("scroll"))})},200*i)})}},t}(),Resource=function(){function t(t){n=t,o="https://api.instagram.com/v1/"+n.endpoint+"/media/recent/"}var n,o;return t.prototype={load:function(){if(o){var t=this,e=$.Deferred();return $.ajax({type:"POST",url:o,data:{access_token:n.access_token,count:n.count},dataType:"jsonp"}).success(function(a){$(t).trigger("loaded",[a.data]),e.resolve(a.data),n.loop||(o=!(!a.pagination||!a.pagination.next_url)&&a.pagination.next_url)}).error(function(){e.reject("Error fetching data")}),e.promise()}},on:function(t,n){$(this).on(t,function(t,o){n(o)})}},t}(),Tile=function(){function t(t,n){o=t,e=n,this.parseLocation(),this.create()}var n,o,e,a="NO_DATA";return t.prototype={create:function(){n=$("<a>").attr({class:"masongram-image-container masongram-image-size-"+e.size});var t=$("<img>").attr({src:o.images[e.size].url,width:o.images[e.size].width,height:o.images[e.size].height,class:"masongram-image"});t.appendTo(n);var a=$("<div>",{class:"masongram-image-caption-container"}),i=$("<div>",{class:"masongram-image-caption"});o.caption&&o.caption.text&&i.html(this.parseCaption()),i.appendTo(a),a.appendTo(n)},getObject:function(){return n},parseLocation:function(){if(o.caption&&o.caption.text&&/@[\d]+\.[\d]+,[\d]+\.[\d]+/.test(o.caption.text)){var t=o.caption.text.match(/@([\d]+\.[\d]+),([\d]+\.[\d]+)/);o.caption.text=o.caption.text.replace(/\s*@([\d]+\.[\d]+),([\d]+\.[\d]+)/,""),o.location={latitude:t[1],longitude:t[2]}}},parseCaption:function(){var t=e.caption;if(/{.*}/.test(t)){var n=t.match(/{([^}]+)}/g);n.forEach(function(n){switch(n){case"{location}":t=t.replace(n,o.location&&void 0!==o.location.latitude&&void 0!==o.location.longitude?o.location.latitude+","+o.location.longitude:a);break;case"{latitude}":t=t.replace(n,o.location&&void 0!==o.location.latitude?o.location.latitude:a);break;case"{longitude}":t=t.replace(n,o.location&&void 0!==o.location.longitude?o.location.longitude:a);break;case"{caption}":t=t.replace(n,o.caption&&void 0!==o.caption.text?o.caption.text:a);break;case"{likes}":t=t.replace(n,o.likes&&void 0!==o.likes.count?o.likes.count:a);break;case"{link}":t=t.replace(n,o.link?o.link:a)}})}return t}},t}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluaXQuanMiLCJtYXNvbmdyYW0uanMiLCJyZXNvdW9yY2UuanMiLCJ0aWxlLmpzIl0sIm5hbWVzIjpbIndpbmRvdyIsIm1hc29uZ3JhbSIsIiQiLCJmbiIsIm9wdGlvbnMiLCJ0aGlzIiwiZWFjaCIsIk1hc29uZ3JhbSIsIiRlbGVtZW50Iiwic2VsZiIsIl9kZXBlbmRlbmNpZXMiLCJmb3JFYWNoIiwibmFtZSIsInJlcXVpcmUiLCJfZXJyb3IiLCJjb25maWd1cmUiLCJzZXR1cCIsIl8kY29udGFpbmVyIiwiX3Jlc291cmNlIiwiX2luUHJvZ3Jlc3MiLCJwcm90b3R5cGUiLCJyZXN1bHQiLCJ1bmRlZmluZWQiLCJjb25zb2xlIiwiZXJyb3IiLCJfY29uZmlnIiwiZXh0ZW5kIiwiZW5kcG9pbnQiLCJsb29wIiwiY291bnQiLCJvZmZzZXQiLCJzaXplIiwiY2FwdGlvbiIsImF0dHIiLCJjbGFzcyIsImFwcGVuZFRvIiwibWFzb25yeSIsIml0ZW1TZWxlY3RvciIsImNvbHVtbldpZHRoIiwicGVyY2VudFBvc2l0aW9uIiwiUmVzb3VyY2UiLCJvbiIsIml0ZW1zIiwiYXBwZW5kIiwic2Nyb2xsVGltZW91dCIsInNjcm9sbCIsInNldFRpbWVvdXQiLCJpbWFnZXNMb2FkZWQiLCJwcm9ncmVzcyIsInNjcm9sbFRvcCIsImhlaWdodCIsImRvY3VtZW50IiwibG9hZCIsIml0ZW0iLCJpbmRleCIsInRpbGUiLCJUaWxlIiwiJG9iamVjdCIsImdldE9iamVjdCIsImxlbmd0aCIsInRyaWdnZXIiLCJjb25maWciLCJfdXJsIiwiZGVmZXJyZWQiLCJEZWZlcnJlZCIsImFqYXgiLCJ0eXBlIiwidXJsIiwiZGF0YSIsImFjY2Vzc190b2tlbiIsImRhdGFUeXBlIiwic3VjY2VzcyIsInJlc3BvbnNlIiwicmVzb2x2ZSIsInBhZ2luYXRpb24iLCJuZXh0X3VybCIsInJlamVjdCIsInByb21pc2UiLCJjYWxsYmFjayIsImV2ZW50IiwiX2RhdGEiLCJwYXJzZUxvY2F0aW9uIiwiY3JlYXRlIiwiXyRvYmplY3QiLCJfTk9fREFUQSIsIiRpbWciLCJzcmMiLCJpbWFnZXMiLCJ3aWR0aCIsIiRjYXB0aW9uQ29udGFpbmVyIiwiJGNhcHRpb24iLCJ0ZXh0IiwiaHRtbCIsInBhcnNlQ2FwdGlvbiIsInRlc3QiLCJsb2NhdGlvbiIsIm1hdGNoIiwicmVwbGFjZSIsImxhdGl0dWRlIiwibG9uZ2l0dWRlIiwibWF0Y2hlcyIsImxpa2VzIiwibGluayJdLCJtYXBwaW5ncyI6IkFBQUEsWUFFQUEsUUFBQUMsVUFBQUMsRUFBQUMsR0FBQUYsVUFBQSxTQUFBRyxHQUNBLE1BQUFDLE1BQUFDLEtBQUEsV0FDQSxHQUFBQyxXQUFBRixLQUFBRCxLQUZBLElBQUFHLFdBQUEsV0NLQSxRQUFBQSxHQUFBQyxFQUFBSixHRFBBLEdBQUFLLEdBQUFKLElBRUFLLEdBQUFDLFFBQUEsU0FBQUMsR0NTQUgsRUFBQUksUUFBQUQsS0FHQUUsSUFJQVQsS0FBQVUsVUFBQVgsR0FDQUMsS0FBQVcsTUFBQVIsSURmQSxHQUZBUixHQ0NBaUIsRUFDQUMsRUFDQUMsRUREQVQsR0FDQSxTQUNBLFdDTEFJLEdBQUEsQ0E0SEEsT0F2R0FQLEdBQUFhLFdBRUFQLFFBQUEsU0FBQUQsR0FDQSxHQUFBUyxHQUFBQyxTQUFBdEIsT0FBQVksRUFLQSxPQUpBUyxLQUNBUCxHQUFBLEVBQ0FTLFFBQUFDLE1BQUEsMkJBQUFaLElBRUFTLEdBR0FOLFVBQUEsU0FBQVgsR0FDQXFCLEVBQUF2QixFQUFBd0IsUUFBQSxHQUNBQyxTQUFBLGFBQ0FDLE1BQUEsRUFDQUMsTUFBQSxHQUNBQyxPQUFBLEdBQ0FDLEtBQUEsaUJBQ0FDLFFBQUEsYUFDQTVCLElBR0FZLE1BQUEsU0FBQVIsR0FDQSxHQUFBQyxHQUFBSixJQUNBWSxHQUFBZixFQUFBLFNBQ0ErQixNQUNBQyxNQUFBLHdCQUVBQyxTQUFBM0IsR0FFQU4sRUFBQSxTQUNBK0IsTUFDQUMsTUFBQSw4Q0FBQVQsRUFBQU0sT0FFQUksU0FBQWxCLEdBRUFBLEVBQUFtQixTQUNBQyxhQUFB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RCxRQUFBMkQsS0FBQVAsRUFDQSxNQUNBLEtBQUEsVUFDQVEsRUFBQUEsRUFBQUssUUFBQUQsRUFBQWhCLEVBQUFxQixPQUFBL0UsU0FBQTBELEVBQUFxQixNQUFBeEUsTUFBQW1ELEVBQUFxQixNQUFBeEUsTUFBQXVELEVBQ0EsTUFDQSxLQUFBLFNBQ0FRLEVBQUFBLEVBQUFLLFFBQUFELEVBQUFoQixFQUFBc0IsS0FBQXRCLEVBQUFzQixLQUFBbEIsTUFNQSxNQUFBUSxLQUtBcEMiLCJmaWxlIjoibWFzb25ncmFtLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0Jztcblxud2luZG93Lm1hc29uZ3JhbSA9ICQuZm4ubWFzb25ncmFtID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgbmV3IE1hc29uZ3JhbSh0aGlzLCBvcHRpb25zKTtcbiAgfSk7XG59O1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG52YXIgTWFzb25ncmFtID0gKGZ1bmN0aW9uICgpIHtcblxuICB2YXIgX2RlcGVuZGVuY2llcyA9IFtcbiAgICAnalF1ZXJ5JyxcbiAgICAnTWFzb25yeScsXG4gIF07XG5cbiAgdmFyIF9lcnJvciA9IGZhbHNlO1xuICB2YXIgX2NvbmZpZztcbiAgdmFyIF8kY29udGFpbmVyO1xuICB2YXIgX3Jlc291cmNlO1xuICB2YXIgX2luUHJvZ3Jlc3M7XG5cbiAgZnVuY3Rpb24gTWFzb25ncmFtKCRlbGVtZW50LCBvcHRpb25zKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgX2RlcGVuZGVuY2llcy5mb3JFYWNoKGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICBzZWxmLnJlcXVpcmUobmFtZSk7XG4gICAgfSk7XG5cbiAgICBpZiAoX2Vycm9yKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5jb25maWd1cmUob3B0aW9ucyk7XG4gICAgdGhpcy5zZXR1cCgkZWxlbWVudCk7XG4gIH1cblxuICBNYXNvbmdyYW0ucHJvdG90eXBlID0ge1xuXG4gICAgcmVxdWlyZTogZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgIHZhciByZXN1bHQgPSB3aW5kb3dbIG5hbWUgXSAhPT0gdW5kZWZpbmVkO1xuICAgICAgaWYgKCFyZXN1bHQpIHtcbiAgICAgICAgX2Vycm9yID0gdHJ1ZTtcbiAgICAgICAgY29uc29sZS5lcnJvcignRGVwZW5kZW5jeSB1bmF2YWlsYWJsZTogJyArIG5hbWUpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9LFxuXG4gICAgY29uZmlndXJlOiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgX2NvbmZpZyA9ICQuZXh0ZW5kKHRydWUsIHtcbiAgICAgICAgZW5kcG9pbnQ6ICd1c2Vycy9zZWxmJyxcbiAgICAgICAgbG9vcDogZmFsc2UsXG4gICAgICAgIGNvdW50OiAxMCxcbiAgICAgICAgb2Zmc2V0OiAxMCxcbiAgICAgICAgc2l6ZTogJ2xvd19yZXNvbHV0aW9uJyxcbiAgICAgICAgY2FwdGlvbjogJ3tjYXB0aW9ufScsXG4gICAgICB9LCBvcHRpb25zKTtcbiAgICB9LFxuXG4gICAgc2V0dXA6IGZ1bmN0aW9uICgkZWxlbWVudCkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgXyRjb250YWluZXIgPSAkKCc8ZGl2PicpXG4gICAgICAgIC5hdHRyKHtcbiAgICAgICAgICBjbGFzczogJ21hc29uZ3JhbS1jb250YWluZXInLFxuICAgICAgICB9KVxuICAgICAgICAuYXBwZW5kVG8oJGVsZW1lbnQpO1xuXG4gICAgICAkKCc8ZGl2PicpXG4gICAgICAgIC5hdHRyKHtcbiAgICAgICAgICBjbGFzczogJ21hc29uZ3JhbS1pbWFnZS1zaXplciBtYXNvbmdyYW0taW1hZ2Utc2l6ZS0nICsgX2NvbmZpZy5zaXplLFxuICAgICAgICB9KVxuICAgICAgICAuYXBwZW5kVG8oXyRjb250YWluZXIpO1xuXG4gICAgICBfJGNvbnRhaW5lci5tYXNvbnJ5KHtcbiAgICAgICAgaXRlbVNlbGVjdG9yOiAnLm1hc29uZ3JhbS1pbWFnZS1jb250YWluZXInLFxuICAgICAgICBjb2x1bW5XaWR0aDogJy5tYXNvbmdyYW0taW1hZ2Utc2l6ZXInLFxuICAgICAgICBwZXJjZW50UG9zaXRpb246IHRydWUsXG4gICAgICB9KTtcblxuICAgICAgX3Jlc291cmNlID0gbmV3IFJlc291cmNlKF9jb25maWcpO1xuXG4gICAgICBfcmVzb3VyY2Uub24oJ2xvYWRlZCcsIGZ1bmN0aW9uIChpdGVtcykge1xuICAgICAgICBzZWxmLmFwcGVuZChpdGVtcyk7XG4gICAgICB9KTtcblxuICAgICAgLy8gbG9hZCBpbWFnZXMgd2hlbiBzY3JvbGxlZCBjbG9zZSB0byBib3R0b21cbiAgICAgIHZhciBzY3JvbGxUaW1lb3V0Oy8vIHRocm90dGxlXG4gICAgICAkKHdpbmRvdykuc2Nyb2xsKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCFzY3JvbGxUaW1lb3V0KSB7XG4gICAgICAgICAgc2Nyb2xsVGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgXyRjb250YWluZXIuaW1hZ2VzTG9hZGVkKCkucHJvZ3Jlc3MoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICBpZiAoJCh3aW5kb3cpLnNjcm9sbFRvcCgpICsgJCh3aW5kb3cpLmhlaWdodCgpID4gJChkb2N1bWVudCkuaGVpZ2h0KCkgKiAoMSAtIF9jb25maWcub2Zmc2V0IC8gMTAwKSkge1xuICAgICAgICAgICAgICAgIHNlbGYubG9hZCgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHNjcm9sbFRpbWVvdXQgPSBudWxsO1xuICAgICAgICAgIH0sIDEwMCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICAvLyBmaWxsIHdpbmRvdyBpZiB0aGVyZSBpcyB3aGl0ZSBzcGFjZSBsZWZ0XG4gICAgICBfJGNvbnRhaW5lci5vbignbGF5b3V0Q29tcGxldGUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIF8kY29udGFpbmVyLmltYWdlc0xvYWRlZCgpLnByb2dyZXNzKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBpZiAoJCgnYm9keScpLmhlaWdodCgpIDwgJCh3aW5kb3cpLmhlaWdodCgpKSB7XG4gICAgICAgICAgICBzZWxmLmxvYWQoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIHNlbGYubG9hZCgpO1xuICAgIH0sXG5cbiAgICBsb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoX2luUHJvZ3Jlc3MpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgX2luUHJvZ3Jlc3MgPSB0cnVlO1xuICAgICAgX3Jlc291cmNlLmxvYWQoKTtcbiAgICB9LFxuXG4gICAgYXBwZW5kOiBmdW5jdGlvbiAoaXRlbXMpIHtcbiAgICAgIGl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7XG4gICAgICAgIHZhciB0aWxlID0gbmV3IFRpbGUoaXRlbSwge1xuICAgICAgICAgIGNhcHRpb246IF9jb25maWcuY2FwdGlvbixcbiAgICAgICAgICBzaXplOiBfY29uZmlnLnNpemUsXG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgJG9iamVjdCA9IHRpbGUuZ2V0T2JqZWN0KCk7XG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICRvYmplY3QuaW1hZ2VzTG9hZGVkKCkucHJvZ3Jlc3MoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgXyRjb250YWluZXIuYXBwZW5kKCRvYmplY3QpLm1hc29ucnkoJ2FwcGVuZGVkJywgJG9iamVjdCk7XG4gICAgICAgICAgICBpZiAoaW5kZXggKyAxID09PSBpdGVtcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgX2luUHJvZ3Jlc3MgPSBmYWxzZTtcbiAgICAgICAgICAgICAgJCh3aW5kb3cpLnRyaWdnZXIoJ3Njcm9sbCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9LCBpbmRleCAqIDIwMCk7XG4gICAgICB9KTtcbiAgICB9LFxuICB9O1xuXG4gIHJldHVybiBNYXNvbmdyYW07XG5cbn0pKCk7XG4iLCIndXNlIHN0cmljdCc7XG5cbnZhciBSZXNvdXJjZSA9IChmdW5jdGlvbiAoKSB7XG5cbiAgdmFyIF9jb25maWc7XG4gIHZhciBfdXJsO1xuXG4gIGZ1bmN0aW9uIFJlc291cmNlKGNvbmZpZykge1xuICAgIF9jb25maWcgPSBjb25maWc7XG4gICAgX3VybCA9ICdodHRwczovL2FwaS5pbnN0YWdyYW0uY29tL3YxLycgKyBfY29uZmlnLmVuZHBvaW50ICsgJy9tZWRpYS9yZWNlbnQvJztcbiAgfVxuXG4gIFJlc291cmNlLnByb3RvdHlwZSA9IHtcblxuICAgIGxvYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICghX3VybCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgIHZhciBkZWZlcnJlZCA9ICQuRGVmZXJyZWQoKTtcblxuICAgICAgJC5hamF4KHtcbiAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICB1cmw6IF91cmwsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBhY2Nlc3NfdG9rZW46IF9jb25maWcuYWNjZXNzX3Rva2VuLFxuICAgICAgICAgIGNvdW50OiBfY29uZmlnLmNvdW50LFxuICAgICAgICB9LFxuICAgICAgICBkYXRhVHlwZTogJ2pzb25wJyxcbiAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICQoc2VsZikudHJpZ2dlcignbG9hZGVkJywgWyByZXNwb25zZS5kYXRhIF0pO1xuICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICBpZiAoIV9jb25maWcubG9vcCkge1xuICAgICAgICAgIC8vIFVzZWQgZm9yIHRlc3RpbmdcbiAgICAgICAgICBfdXJsID0gcmVzcG9uc2UucGFnaW5hdGlvbiAmJiByZXNwb25zZS5wYWdpbmF0aW9uLm5leHRfdXJsID8gcmVzcG9uc2UucGFnaW5hdGlvbi5uZXh0X3VybCA6IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9KS5lcnJvcihmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRlZmVycmVkLnJlamVjdCgnRXJyb3IgZmV0Y2hpbmcgZGF0YScpO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlKCk7XG4gICAgfSxcblxuICAgIG9uOiBmdW5jdGlvbiAobmFtZSwgY2FsbGJhY2spIHtcbiAgICAgICQodGhpcykub24obmFtZSwgZnVuY3Rpb24gKGV2ZW50LCBkYXRhKSB7XG4gICAgICAgIGNhbGxiYWNrKGRhdGEpO1xuICAgICAgfSk7XG4gICAgfSxcblxuICB9O1xuXG4gIHJldHVybiBSZXNvdXJjZTtcblxufSkoKTtcbiIsIid1c2Ugc3RyaWN0JztcblxudmFyIFRpbGUgPSAoZnVuY3Rpb24gKCkge1xuXG4gIHZhclxuICAgIF8kb2JqZWN0LFxuICAgIF9kYXRhLFxuICAgIF9jb25maWcsXG4gICAgX05PX0RBVEEgPSAnTk9fREFUQSc7XG5cbiAgZnVuY3Rpb24gVGlsZShkYXRhLCBjb25maWcpIHtcbiAgICBfZGF0YSA9IGRhdGE7XG4gICAgX2NvbmZpZyA9IGNvbmZpZztcbiAgICB0aGlzLnBhcnNlTG9jYXRpb24oKTtcbiAgICB0aGlzLmNyZWF0ZSgpO1xuICB9XG5cbiAgVGlsZS5wcm90b3R5cGUgPSB7XG5cbiAgICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgIF8kb2JqZWN0ID0gJCgnPGE+JykuYXR0cih7XG4gICAgICAgIGNsYXNzOiAnbWFzb25ncmFtLWltYWdlLWNvbnRhaW5lciBtYXNvbmdyYW0taW1hZ2Utc2l6ZS0nICsgX2NvbmZpZy5zaXplLFxuICAgICAgfSk7XG5cbiAgICAgIHZhciAkaW1nID0gJCgnPGltZz4nKS5hdHRyKHtcbiAgICAgICAgc3JjOiBfZGF0YS5pbWFnZXNbIF9jb25maWcuc2l6ZSBdLnVybCxcbiAgICAgICAgd2lkdGg6IF9kYXRhLmltYWdlc1sgX2NvbmZpZy5zaXplIF0ud2lkdGgsXG4gICAgICAgIGhlaWdodDogX2RhdGEuaW1hZ2VzWyBfY29uZmlnLnNpemUgXS5oZWlnaHQsXG4gICAgICAgIGNsYXNzOiAnbWFzb25ncmFtLWltYWdlJyxcbiAgICAgIH0pO1xuXG4gICAgICAkaW1nLmFwcGVuZFRvKF8kb2JqZWN0KTtcblxuICAgICAgdmFyICRjYXB0aW9uQ29udGFpbmVyID0gJCgnPGRpdj4nLCB7XG4gICAgICAgIGNsYXNzOiAnbWFzb25ncmFtLWltYWdlLWNhcHRpb24tY29udGFpbmVyJyxcbiAgICAgIH0pO1xuXG4gICAgICB2YXIgJGNhcHRpb24gPSAkKCc8ZGl2PicsIHtcbiAgICAgICAgY2xhc3M6ICdtYXNvbmdyYW0taW1hZ2UtY2FwdGlvbicsXG4gICAgICB9KTtcblxuICAgICAgaWYgKF9kYXRhLmNhcHRpb24gJiYgX2RhdGEuY2FwdGlvbi50ZXh0KSB7XG4gICAgICAgICRjYXB0aW9uLmh0bWwodGhpcy5wYXJzZUNhcHRpb24oKSk7XG4gICAgICB9XG5cbiAgICAgICRjYXB0aW9uLmFwcGVuZFRvKCRjYXB0aW9uQ29udGFpbmVyKTtcbiAgICAgICRjYXB0aW9uQ29udGFpbmVyLmFwcGVuZFRvKF8kb2JqZWN0KTtcbiAgICB9LFxuXG4gICAgZ2V0T2JqZWN0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gXyRvYmplY3Q7XG4gICAgfSxcblxuICAgIHBhcnNlTG9jYXRpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChfZGF0YS5jYXB0aW9uICYmIF9kYXRhLmNhcHRpb24udGV4dCAmJiAvQFtcXGRdK1xcLltcXGRdKyxbXFxkXStcXC5bXFxkXSsvLnRlc3QoX2RhdGEuY2FwdGlvbi50ZXh0KSkge1xuICAgICAgICB2YXIgbG9jYXRpb24gPSBfZGF0YS5jYXB0aW9uLnRleHQubWF0Y2goL0AoW1xcZF0rXFwuW1xcZF0rKSwoW1xcZF0rXFwuW1xcZF0rKS8pO1xuICAgICAgICBfZGF0YS5jYXB0aW9uLnRleHQgPSBfZGF0YS5jYXB0aW9uLnRleHQucmVwbGFjZSgvXFxzKkAoW1xcZF0rXFwuW1xcZF0rKSwoW1xcZF0rXFwuW1xcZF0rKS8sICcnKTtcbiAgICAgICAgX2RhdGEubG9jYXRpb24gPSB7XG4gICAgICAgICAgbGF0aXR1ZGU6IGxvY2F0aW9uWyAxIF0sXG4gICAgICAgICAgbG9uZ2l0dWRlOiBsb2NhdGlvblsgMiBdLFxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBwYXJzZUNhcHRpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBodG1sID0gX2NvbmZpZy5jYXB0aW9uO1xuXG4gICAgICBpZiAoL3suKn0vLnRlc3QoaHRtbCkpIHtcbiAgICAgICAgdmFyIG1hdGNoZXMgPSBodG1sLm1hdGNoKC97KFtefV0rKX0vZyk7XG4gICAgICAgIG1hdGNoZXMuZm9yRWFjaChmdW5jdGlvbiAobWF0Y2gpIHtcbiAgICAgICAgICBzd2l0Y2ggKG1hdGNoKSB7XG4gICAgICAgICAgICBjYXNlICd7bG9jYXRpb259JzpcbiAgICAgICAgICAgICAgaHRtbCA9IGh0bWwucmVwbGFjZShtYXRjaCwgX2RhdGEubG9jYXRpb24gJiYgX2RhdGEubG9jYXRpb24ubGF0aXR1ZGUgIT09IHVuZGVmaW5lZCAmJiBfZGF0YS5sb2NhdGlvbi5sb25naXR1ZGUgIT09IHVuZGVmaW5lZCA/IChfZGF0YS5sb2NhdGlvbi5sYXRpdHVkZSArICcsJyArIF9kYXRhLmxvY2F0aW9uLmxvbmdpdHVkZSkgOiBfTk9fREFUQSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAne2xhdGl0dWRlfSc6XG4gICAgICAgICAgICAgIGh0bWwgPSBodG1sLnJlcGxhY2UobWF0Y2gsIF9kYXRhLmxvY2F0aW9uICYmIF9kYXRhLmxvY2F0aW9uLmxhdGl0dWRlICE9PSB1bmRlZmluZWQgPyBfZGF0YS5sb2NhdGlvbi5sYXRpdHVkZSA6IF9OT19EQVRBKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd7bG9uZ2l0dWRlfSc6XG4gICAgICAgICAgICAgIGh0bWwgPSBodG1sLnJlcGxhY2UobWF0Y2gsIF9kYXRhLmxvY2F0aW9uICYmIF9kYXRhLmxvY2F0aW9uLmxvbmdpdHVkZSAhPT0gdW5kZWZpbmVkID8gX2RhdGEubG9jYXRpb24ubG9uZ2l0dWRlIDogX05PX0RBVEEpO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3tjYXB0aW9ufSc6XG4gICAgICAgICAgICAgIGh0bWwgPSBodG1sLnJlcGxhY2UobWF0Y2gsIF9kYXRhLmNhcHRpb24gJiYgX2RhdGEuY2FwdGlvbi50ZXh0ICE9PSB1bmRlZmluZWQgPyBfZGF0YS5jYXB0aW9uLnRleHQgOiBfTk9fREFUQSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAne2xpa2VzfSc6XG4gICAgICAgICAgICAgIGh0bWwgPSBodG1sLnJlcGxhY2UobWF0Y2gsIF9kYXRhLmxpa2VzICYmIF9kYXRhLmxpa2VzLmNvdW50ICE9PSB1bmRlZmluZWQgPyBfZGF0YS5saWtlcy5jb3VudCA6IF9OT19EQVRBKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd7bGlua30nOlxuICAgICAgICAgICAgICBodG1sID0gaHRtbC5yZXBsYWNlKG1hdGNoLCBfZGF0YS5saW5rID8gX2RhdGEubGluayA6IF9OT19EQVRBKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGh0bWw7XG4gICAgfSxcblxuICB9O1xuXG4gIHJldHVybiBUaWxlO1xuXG59KSgpO1xuIl19
